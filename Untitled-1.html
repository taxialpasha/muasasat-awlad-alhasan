<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استمارة معلومات الحالة - مؤسسة أولاد الحسن الخيرية</title>
    <style>
        @page {
            size: A4 portrait;
            margin: 0;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Traditional Arabic', Arial, sans-serif;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            font-size: 14px;
        }
        
        .container {
            width: 21cm;
            height: 29.7cm;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #000;
            position: relative;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* تنسيق الطباعة */
        @media print {
            html, body {
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 0;
            }
            
            body {
                background-color: white;
            }
            
            .container {
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 0;
                box-shadow: none;
                border: none;
                page-break-after: avoid;
                page-break-inside: avoid;
            }
            
            .no-print {
                display: none !important;
            }
            
            .form-content {
                flex: 1;
            }
        }
        
        /* تنسيق الرأس */
        .header {
            background-color: #FFD966;
            padding: 5px;
            border-bottom: 1px solid #000;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            height: auto;
        }
        
        .header-right {
            text-align: right;
            font-size: 12px;
            padding-right: 10px;
        }
        
        .header-center {
            text-align: center;
        }
        
        .header-left {
            text-align: left;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            margin: 0 auto;
            display: block;
        }
        
        .org-name {
            font-size: 16px;
            font-weight: bold;
            margin: 2px 0;
        }
        
        .form-title {
            font-size: 14px;
            margin: 2px 0;
        }
        
        /* تنسيق محتوى النموذج */
        .form-content {
            padding: 5px 10px;
            flex: 1;
            overflow: hidden;
        }
        
        .form-row {
            display: flex;
            width: 100%;
            border-bottom: 1px solid #ccc;
            padding-bottom: 3px;
            margin-bottom: 5px;
            position: relative;
            min-height: 30px;
        }
        
        .form-field {
            flex: 1;
            position: relative;
            padding: 0 5px;
            margin-top: 18px; /* زيادة التباعد من الأعلى */
        }
        
        /* تحسين عنوان الحقل */
        .field-label {
            position: absolute;
            top: -18px; /* تعديل موضع العنوان للأعلى */
            right: 7px;
            font-size: 11px;
            font-weight: bold;
            color: #444;
            background-color: white;
            padding: 0 4px;
            z-index: 5;
        }
        
        /* إصلاح مشكلة ظهور الأرقام والنصوص */
        .dotted-line {
            border: none;
            border-bottom: 1px dotted #000;
            background-color: transparent;
            width: 100%;
            height: 24px;
            font-family: inherit;
            font-size: 14px;
            padding: 0 4px;
            padding-bottom: 2px; /* تعديل لإنزال النص للأسفل قليلاً */
            margin: 0;
            outline: none;
            display: block;
            text-align: right;
            direction: rtl;
            position: relative;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            box-sizing: border-box;
            line-height: 20px;
        }

        /* تحسين ظهور القيم في الحقول الصغيرة */
        .small-field {
            width: 45px;
            text-align: center;
            display: inline-block;
            border: none;
            border-bottom: 1px dotted #000;
            height: 24px;
            font-size: 14px;
            line-height: 20px;
            padding: 0 2px;
            margin: 0 2px;
            position: relative;
            bottom: -1px; /* تعديل لمحاذاة الحقول الصغيرة */
        }
        
        /* تنسيق الأقواس */
        .parentheses {
            display: inline-block;
            margin: 0 2px;
            line-height: 24px;
            height: 24px;
        }
        
        /* تنسيق حقول التاريخ */
        .date-field {
            width: 25px;
            text-align: center;
            display: inline-block;
            border: none;
            border-bottom: 1px dotted #000;
            margin: 0 2px;
            font-size: 14px;
            padding: 0;
            height: 24px;
            line-height: 20px;
            position: relative;
            bottom: -1px; /* تعديل لمحاذاة حقول التاريخ */
        }
        
        /* تنسيق الأرقام الصفرية */
        .zero-val {
            color: #aaa;
        }
        
        /* تنسيق القسم السفلي */
        .footer-section {
            margin-top: 5px;
            padding: 5px 10px;
        }
        
        .signature-row {
            margin-top: 5px;
            border-top: 1px solid #ddd;
            padding-top: 5px;
            text-align: center;
            font-size: 13px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        .signature-row p {
            margin: 5px 0;
        }
        
        .signature-label {
            display: inline-block;
            margin-right: 5px;
            font-weight: bold;
        }
        
        /* تنسيق الأزرار */
        .button-container {
            text-align: center;
            margin: 10px 0;
            position: fixed;
            bottom: 10px;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        button {
            padding: 8px 15px;
            background-color: #FFD966;
            border: 1px solid #cca755;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 0 5px;
        }
        
        button:hover {
            background-color: #e6c449;
        }

        /* تنسيقات محددة للمتصفحات */
        input[type="text"] {
            outline: none;
        }

        /* تصحيح موضع النص في فايرفوكس */
        @-moz-document url-prefix() {
            .dotted-line, .small-field, .date-field {
                padding-top: 4px;
            }
        }

        /* تصحيح موضع النص في كروم وسفاري */
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            .dotted-line, .small-field, .date-field {
                padding-top: 2px;
            }
        }

        /* تحسين الإطار العام للتأكد من مناسبة الطباعة */
        .compact-layout .form-row {
            margin-bottom: 1px;
            min-height: 25px;
        }
        
        .compact-layout .form-field {
            margin-top: 15px;
        }
        
        .compact-layout .field-label {
            top: -15px;
        }
        
        /* تأكيد عدم اقتطاع النص */
        input, select, textarea {
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div class="container" id="formContainer">
        <!-- الرأس -->
        <div class="header">
            <div class="header-right">
                <div>رمز الحالة: مصاريف</div>
                <div>نوع الحالة: <span id="caseType">...............</span></div>
                <div>التاريخ: <span id="date">29 / 6 / 2020 م</span></div>
                <div>المنظم: <span id="organizer">محمد حسن</span></div>
            </div>
            <div class="header-center">
                <svg class="logo" viewBox="0 0 100 100">
                    <circle cx="50" cy="35" r="15" fill="#3498db" />
                    <path d="M30,60 Q50,80 70,60" stroke="#3498db" stroke-width="4" fill="none" />
                </svg>
                <div class="org-name">مؤسسة أولاد الحسن ع</div>
                <div class="form-title">استمارة معلومات الحالة</div>
                <div class="org-name">الخيرية</div>
            </div>
            <div class="header-left">
                <!-- الجزء الأيسر من الرأس -->
            </div>
        </div>
        
        <!-- محتوى النموذج -->
        <div class="form-content">
            <!-- البيانات الشخصية -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">الاسم الكامل</span>
                    <input type="text" class="dotted-line" id="fullName">
                </div>
                <div class="form-field">
                    <span class="field-label">اللقب</span>
                    <input type="text" class="dotted-line" id="title">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">أبو / أم</span>
                    <span class="parentheses">(</span>
                    <input type="text" class="small-field" id="parent">
                    <span class="parentheses">)</span>
                </div>
                <div class="form-field">
                    <span class="field-label">العمر</span>
                    <span class="parentheses">(</span>
                    <input type="text" class="small-field" id="age">
                    <span class="parentheses">)</span>
                </div>
                <div class="form-field">
                    <span class="field-label">الحالة الاجتماعية</span>
                    <span class="parentheses">(</span>
                    <input type="text" class="dotted-line" id="socialStatus">
                    <span class="parentheses">)</span>
                </div>
            </div>
            
            <!-- شرح الحالة -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">شرح الحالة</span>
                    <input type="text" class="dotted-line" id="caseDescription">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">الموثق</span>
                    <input type="text" class="dotted-line" id="documenter">
                </div>
                <div class="form-field">
                    <span class="field-label">اسم المختار</span>
                    <input type="text" class="dotted-line" id="mukhtarName">
                </div>
            </div>
            
            <!-- المعلومات المالية -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">راتب حكومي</span>
                    <input type="text" class="dotted-line zero-val" id="govSalary" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">راتب مؤسسة</span>
                    <input type="text" class="dotted-line zero-val" id="orgSalary" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">مقدار الدخل</span>
                    <input type="text" class="dotted-line zero-val" id="incomeAmount" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">المصروفات</span>
                    <input type="text" class="dotted-line zero-val" id="expenses" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">باقي الدخل</span>
                    <input type="text" class="dotted-line zero-val" id="remainingIncome" value="0">
                </div>
            </div>
            
            <!-- معلومات السكن -->
            <div class="form-row">
                <div class="form-field" style="flex: 2;">
                    <span class="field-label">العنوان وأقرب نقطة دالة</span>
                    <input type="text" class="dotted-line" id="address">
                </div>
                <div class="form-field">
                    <span class="field-label">نوع السكن</span>
                    <input type="text" class="dotted-line" id="housingType" value="ملك">
                </div>
            </div>
            
            <!-- عدد أفراد الأسرة -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">عدد أفراد الأسرة: الكلي</span>
                    <input type="text" class="dotted-line zero-val" id="totalMembers" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">بنين</span>
                    <input type="text" class="dotted-line zero-val" id="males" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">بنات</span>
                    <input type="text" class="dotted-line zero-val" id="females" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">متزوجين</span>
                    <input type="text" class="dotted-line zero-val" id="married" value="0">
                </div>
            </div>
            
            <!-- المعلومات الطبية -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">اسم المستشفى أو الحالة</span>
                    <input type="text" class="dotted-line zero-val" id="hospitalName" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">العنوان</span>
                    <input type="text" class="dotted-line zero-val" id="hospitalAddress" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">نوع الحالة</span>
                    <input type="text" class="dotted-line zero-val" id="conditionType" value="0">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">المبلغ رقماً</span>
                    <input type="text" class="dotted-line zero-val" id="amountNum" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">المبلغ كتابة</span>
                    <input type="text" class="dotted-line zero-val" id="amountText" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">المجموع</span>
                    <input type="text" class="dotted-line zero-val" id="total" value="0">
                </div>
                <div class="form-field">
                    <span class="field-label">اسم الدكتور</span>
                    <input type="text" class="dotted-line zero-val" id="doctorName" value="0">
                </div>
            </div>
            
            <!-- معلومات الاتصال -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">رقم الهاتف الأول</span>
                    <input type="text" class="dotted-line" id="phone1">
                </div>
                <div class="form-field">
                    <span class="field-label">رقم الهاتف الثاني</span>
                    <input type="text" class="dotted-line" id="phone2">
                </div>
            </div>
            
            <!-- معلومات الزوج/ة -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">الزوج/ة</span>
                    <input type="text" class="dotted-line" id="spouse">
                </div>
                <div class="form-field">
                    <span class="field-label">اللقب</span>
                    <input type="text" class="dotted-line" id="spouseTitle">
                </div>
                <div class="form-field">
                    <span class="field-label">المهنة</span>
                    <input type="text" class="dotted-line" id="job">
                </div>
                <div class="form-field">
                    <span class="field-label">الراتب</span>
                    <input type="text" class="dotted-line" id="salary">
                </div>
            </div>
            
            <!-- معلومات إضافية -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">هل يوجد معيل آخر</span>
                    <input type="text" class="dotted-line" id="otherProvider" value="لا">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">الجهات التي تقوم بالمساعدة</span>
                    <input type="text" class="dotted-line" id="helpingOrgs">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">الملاحظات</span>
                    <input type="text" class="dotted-line" id="notes">
                </div>
            </div>
            
            <!-- يصرف مبلغ المساعدة -->
            <div class="form-row">
                <div class="form-field">
                    <span class="field-label">يصرف مبلغ المساعدة المقدر</span>
                    <span class="parentheses">(</span>
                    <input type="text" class="dotted-line" id="estimatedHelp" style="width: 80%;">
                    <span class="parentheses">)</span>
                </div>
            </div>
        </div>
        
        <!-- القسم السفلي والتوقيعات -->
        <div class="footer-section">
            <div class="signature-row">
                <span class="signature-label">إدارة المؤسسة</span>
            </div>
            
            <div class="signature-row">
                <span>تم صرف مبلغ</span>
                <span class="parentheses">(</span>
                <input type="text" class="dotted-line" id="amountPaid" style="width: 150px;">
                <span class="parentheses">)</span>
                <span>بتاريخ</span>
                <input type="text" class="date-field" id="paymentDay">
                /
                <input type="text" class="date-field" id="paymentMonth">
                /
                <input type="text" class="date-field" id="paymentYear" value="20">
            </div>
            
            <div class="signature-row">
                <p>السيد أسامة السعبري و السيد فؤاد السعبري</p>
                <input type="text" class="date-field" id="managementDay">
                /
                <input type="text" class="date-field" id="managementMonth">
                /
                <input type="text" class="date-field" id="managementYear" value="20">
            </div>
        </div>
        
        <!-- الأزرار -->
        <div class="button-container no-print">
            <button id="printBtn">طباعة النموذج</button>
            <button id="resetBtn">إعادة تعيين</button>
            <button id="compactModeBtn">تنسيق الطباعة</button>
        </div>
    </div>

    <script>
        // حساب باقي الدخل
        function calculateRemainingIncome() {
            const income = parseFloat(document.getElementById('incomeAmount').value) || 0;
            const expenses = parseFloat(document.getElementById('expenses').value) || 0;
            const remainingIncome = income - expenses;
            
            document.getElementById('remainingIncome').value = remainingIncome.toString();
            
            // تحديث نمط الرقم
            if (remainingIncome === 0) {
                document.getElementById('remainingIncome').classList.add('zero-val');
            } else {
                document.getElementById('remainingIncome').classList.remove('zero-val');
            }
        }
        
        // إضافة مستمعي الأحداث للحقول المالية
        document.getElementById('incomeAmount').addEventListener('input', calculateRemainingIncome);
        document.getElementById('expenses').addEventListener('input', calculateRemainingIncome);
        
        // تنفيذ الطباعة
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });
        
        // تفعيل وضع التنسيق المضغوط للطباعة
        document.getElementById('compactModeBtn').addEventListener('click', function() {
            const container = document.getElementById('formContainer');
            container.classList.toggle('compact-layout');
            
            if (container.classList.contains('compact-layout')) {
                this.textContent = 'إلغاء تنسيق الطباعة';
            } else {
                this.textContent = 'تنسيق الطباعة';
            }
        });
        
        // إعادة تعيين النموذج
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من رغبتك في إعادة تعيين جميع الحقول؟')) {
                // إعادة تعيين جميع الحقول النصية
                document.querySelectorAll('input[type="text"]').forEach(function(input) {
                    if (['govSalary', 'orgSalary', 'incomeAmount', 'expenses', 
                       'remainingIncome', 'totalMembers', 'males', 'females', 
                       'married', 'hospitalName', 'hospitalAddress', 'conditionType', 
                       'amountNum', 'amountText', 'total', 'doctorName'].includes(input.id)) {
                        input.value = '0';
                        input.classList.add('zero-val');
                    } else if (input.id === 'housingType') {
                        input.value = 'ملك';
                    } else if (input.id === 'otherProvider') {
                        input.value = 'لا';
                    } else if (input.id === 'paymentYear' || input.id === 'managementYear') {
                        input.value = '20';
                    } else {
                        input.value = '';
                    }
                });
                
                // إعادة تعيين المعلومات الثابتة
                document.getElementById('caseType').textContent = '...............';
                
                // تعيين التاريخ الحالي
                const today = new Date();
                const formattedDate = today.getDate() + ' / ' + (today.getMonth() + 1) + ' / ' + today.getFullYear() + ' م';
                document.getElementById('date').textContent = formattedDate;
                
                document.getElementById('organizer').textContent = 'محمد حسن';
            }
        });
        
        // تحسين معالجة الأرقام الصفرية
        document.querySelectorAll('.zero-val').forEach(function(input) {
            // إضافة معالج للتركيز على الحقل
            input.addEventListener('focus', function() {
                if (this.value === '0') {
                    this.value = '';
                    this.classList.remove('zero-val');
                }
            });
            
            // إضافة معالج لترك الحقل
            input.addEventListener('blur', function() {
                if (this.value === '') {
                    this.value = '0';
                    this.classList.add('zero-val');
                } else if (this.value !== '0') {
                    this.classList.remove('zero-val');
                }
            });
            
            // التحقق من قيمة الإدخال أثناء الكتابة
            input.addEventListener('input', function() {
                if (this.value === '0' || this.value === '') {
                    this.classList.add('zero-val');
                } else {
                    this.classList.remove('zero-val');
                }
            });
        });
        
        // وضع تاريخ اليوم افتراضيًا
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const day = today.getDate();
            const month = today.getMonth() + 1;
            const year = today.getFullYear().toString().slice(-2);
            
            // تعيين حقول التاريخ
            document.getElementById('paymentDay').value = day;
            document.getElementById('paymentMonth').value = month;
            document.getElementById('managementDay').value = day;
            document.getElementById('managementMonth').value = month;
            
            // تحديث تاريخ النموذج
            const formattedDate = day + ' / ' + month + ' / ' + today.getFullYear() + ' م';
            document.getElementById('date').textContent = formattedDate;
            
            // تطبيق الوضع المضغوط افتراضيًا للطباعة
            if (window.matchMedia && window.matchMedia('print').matches) {
                document.getElementById('formContainer').classList.add('compact-layout');
            }
        });
        
        // تعديل حجم الخط بناءً على حجم الشاشة
        function adjustFontSize() {
            const container = document.getElementById('formContainer');
            const formContent = document.querySelector('.form-content');
            
            // ضبط المسافات حسب ارتفاع المحتوى
            if (formContent.scrollHeight > formContent.clientHeight) {
                container.classList.add('compact-layout');
            }
        }
        
        // تنفيذ ضبط الحجم عند تحميل الصفحة
        window.addEventListener('load', adjustFontSize);
        window.addEventListener('resize', adjustFontSize);
    </script>
</body>
</html>