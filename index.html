<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --info-color: #3498db;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --border-radius: 15px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-success: linear-gradient(135deg, #56ab2f, #a8e6cf);
            --gradient-warning: linear-gradient(135deg, #f7971e, #ffd200);
            --gradient-error: linear-gradient(135deg, #ff416c, #ff4b2b);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--dark-color);
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .top-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .top-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .live-time {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            font-weight: bold;
        }

        .nav-container {
            background: white;
            padding: 0 20px;
            border-bottom: 1px solid #e1e8ed;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            padding: 15px 0;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 20px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 14px;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .tab-btn.active {
            background: var(--gradient-success);
            transform: translateY(-2px);
        }

        .content-container {
            padding: 20px;
            min-height: calc(100vh - 300px);
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .stat-change {
            font-size: 0.9em;
            margin-top: 5px;
            opacity: 0.8;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            border: 1px solid #e1e8ed;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e8ed;
        }

        .card-title {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--dark-color);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .form-section {
            background: #f8f9fb;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #e1e8ed;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: 14px;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
        }

        .btn-danger {
            background: var(--gradient-error);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-color), #5dade2);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-lg {
            padding: 15px 30px;
            font-size: 16px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        th, td {
            padding: 15px 12px;
            text-align: right;
            border-bottom: 1px solid #e1e8ed;
            font-size: 14px;
        }

        th {
            background: var(--gradient-primary);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        tr:nth-child(even) {
            background: rgba(248, 249, 251, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 25px;
            border-radius: var(--border-radius);
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: var(--error-color);
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 18px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .product-card {
            border: 2px solid #e1e8ed;
            border-radius: var(--border-radius);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .product-card:hover::before {
            left: 100%;
        }

        .product-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .product-card.selected {
            border-color: var(--success-color);
            background: rgba(39, 174, 96, 0.05);
        }

        .product-image {
            width: 100%;
            height: 100px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        .product-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-info h4 {
            margin-bottom: 8px;
            font-size: 16px;
            line-height: 1.3;
        }

        .product-info p {
            margin: 3px 0;
            font-size: 13px;
        }

        .product-price {
            color: var(--success-color);
            font-weight: bold;
            margin-top: 5px;
            font-size: 16px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            margin-top: 5px;
        }

        .status-active { background: var(--success-color); color: white; }
        .status-pending { background: var(--warning-color); color: white; }
        .status-completed { background: var(--info-color); color: white; }
        .status-cancelled { background: var(--error-color); color: white; }
        .status-low-stock { background: var(--warning-color); color: white; animation: pulse 2s infinite; }
        .status-out-of-stock { background: var(--error-color); color: white; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .currency {
            color: var(--success-color);
            font-weight: bold;
        }

        .progress-container {
            background: #e1e8ed;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
            margin-top: 10px;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-success);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .tabs-secondary {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 1px solid #e1e8ed;
            margin-bottom: 20px;
        }

        .tab-secondary {
            padding: 15px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #666;
        }

        .tab-secondary.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .analytics-chart {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .filter-section {
            background: #f8f9fb;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid #e1e8ed;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1500;
            overflow-y: auto;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .sidebar-content {
            padding: 20px;
        }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .accordion {
            border: 1px solid #e1e8ed;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .accordion-header {
            background: #f8f9fb;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid #e1e8ed;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion-header:hover {
            background: #e9ecef;
        }

        .accordion-header:after {
            content: '+';
            font-size: 20px;
        }

        .accordion-header.active:after {
            content: '-';
        }

        .accordion-content {
            padding: 20px;
            display: none;
            border-bottom: 1px solid #e1e8ed;
        }

        .accordion-content.active {
            display: block;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: center;
        }

        .cart-quantity {
            display: inline-block;
            min-width: 30px;
            text-align: center;
        }

        .cart-summary {
            background: #f8f9fb;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
        }

        .cart-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2em;
            font-weight: bold;
            border-top: 2px solid #e1e8ed;
            padding-top: 10px;
            margin-top: 10px;
        }

        .customer-info {
            background: var(--info-color);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: bold;
            border-radius: 12px;
            text-transform: uppercase;
        }

        .badge-primary { background: var(--primary-color); color: white; }
        .badge-success { background: var(--success-color); color: white; }
        .badge-warning { background: var(--warning-color); color: white; }
        .badge-danger { background: var(--error-color); color: white; }
        .badge-info { background: var(--info-color); color: white; }

        .product-actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 5px;
                border-radius: 10px;
            }
            
            .content-container {
                padding: 15px;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tab-btn {
                margin: 2px 0;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .modal-content {
                width: 98%;
                margin: 2% auto;
            }
            
            .user-info,
            .live-time {
                position: static;
                display: inline-block;
                margin: 5px;
            }
            
            .top-header {
                text-align: center;
                padding: 10px;
            }
            
            .top-header h1 {
                font-size: 1.8em;
            }
            
            .sidebar {
                width: 100%;
                right: -100%;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-color);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        .required-field::after {
            content: " *";
            color: var(--error-color);
        }

        .centered-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .flex-space-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .receipt {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            font-family: 'Courier New', Courier, monospace;
        }

        .receipt-header {
            text-align: center;
            border-bottom: 1px dashed #000;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .receipt-items {
            margin: 20px 0;
        }

        .receipt-footer {
            text-align: center;
            border-top: 1px dashed #000;
            padding-top: 10px;
            margin-top: 10px;
        }

        .panel-tabs {
            margin-bottom: 20px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }
        
        .product-form {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
        <div class="top-header">
            <div class="user-info">
                <span id="currentUser">ğŸ‘¤ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</span>
            </div>
            <h1>ğŸª Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ØªØ·ÙˆØ±</h1>
            <div class="live-time" id="liveTime"></div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="nav-container">
            <div class="nav-tabs">
                <button class="tab-btn" id="btn-pos" onclick="showTab('pos')">ğŸ’° Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
                <button class="tab-btn" id="btn-products" onclick="showTab('products')">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                <button class="tab-btn" id="btn-customers" onclick="showTab('customers')">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
                <button class="tab-btn" id="btn-suppliers" onclick="showTab('suppliers')">ğŸšš Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
                <button class="tab-btn" id="btn-installments" onclick="showTab('installments')">ğŸ“… Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</button>
                <button class="tab-btn" id="btn-sales" onclick="showTab('sales')">ğŸ“ˆ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
                <button class="tab-btn" id="btn-returns" onclick="showTab('returns')">â†©ï¸ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</button>
                <button class="tab-btn" id="btn-expenses" onclick="showTab('expenses')">ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
                <button class="tab-btn" id="btn-reports" onclick="showTab('reports')">ğŸ“‹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
                <button class="tab-btn" id="btn-dashboard" onclick="showTab('dashboard')">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                <button class="tab-btn" id="btn-settings" onclick="showTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
        </div>

        <div class="content-container">
            <!-- Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
            <div id="pos" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                        </div>
                        <div class="search-container">
                            <input type="text" id="productSearch" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ØŒ Ø£Ùˆ Ø§Ù„ÙØ¦Ø©..." oninput="searchProducts()">
                            <span class="search-icon">ğŸ”</span>
                        </div>

                        <div class="filter-section">
                            <div class="filter-row">
                                <div class="form-group">
                                    <label>Ø§Ù„ÙØ¦Ø©</label>
                                    <select id="categoryFilter" onchange="filterProducts()">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³Ø¹Ø±</label>
                                    <select id="priceRange" onchange="filterProducts()">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</option>
                                        <option value="0-50000">Ø£Ù‚Ù„ Ù…Ù† 50,000 Ø¯.Ø¹</option>
                                        <option value="50000-200000">50,000 - 200,000 Ø¯.Ø¹</option>
                                        <option value="200000-500000">200,000 - 500,000 Ø¯.Ø¹</option>
                                        <option value="500000+">Ø£ÙƒØ«Ø± Ù…Ù† 500,000 Ø¯.Ø¹</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                    <select id="stockFilter" onchange="filterProducts()">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
                                        <option value="available">Ù…ØªÙˆÙØ±</option>
                                        <option value="low">Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶</option>
                                        <option value="out">ØºÙŠØ± Ù…ØªÙˆÙØ±</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="product-grid" id="productGrid">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                            <div class="centered-content">
                                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ›’ Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
                            <button class="btn btn-warning btn-sm" onclick="openCustomerModal()">Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„</button>
                        </div>
                        
                        <div id="selectedCustomer" class="customer-info" style="display: none;">
                            <div>
                                <strong>Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯:</strong> <span id="customerName"></span>
                            </div>
                            <button class="btn btn-sm btn-danger" onclick="clearSelectedCustomer()">Ø¥Ù„ØºØ§Ø¡</button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th>Ø§Ù„Ø®ØµÙ…</th>
                                        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                        <th>Ø­Ø°Ù</th>
                                    </tr>
                                </thead>
                                <tbody id="cartItems">
                                    <tr>
                                        <td colspan="6" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø©</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div style="margin-top: 20px;">
                            <div class="form-section">
                                <div class="form-group">
                                    <label>Ø®ØµÙ… Ø¥Ø¶Ø§ÙÙŠ (%)</label>
                                    <input type="number" id="totalDiscount" value="0" min="0" max="100" oninput="updateCartTotal()">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (%)</label>
                                    <input type="number" id="taxRate" value="0" min="0" max="50" oninput="updateCartTotal()">
                                </div>
                            </div>

                            <div class="cart-summary">
                                <div class="cart-row">
                                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                                    <span id="subtotal" class="currency">0 Ø¯.Ø¹</span>
                                </div>
                                <div class="cart-row">
                                    <span>Ø§Ù„Ø®ØµÙ…:</span>
                                    <span id="discountAmount" class="currency">0 Ø¯.Ø¹</span>
                                </div>
                                <div class="cart-row">
                                    <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                                    <span id="taxAmount" class="currency">0 Ø¯.Ø¹</span>
                                </div>
                                <div class="cart-total">
                                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                                    <span id="totalAmount" class="currency">0 Ø¯.Ø¹</span>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-success btn-lg" onclick="processCashSale()">ğŸ’° Ø¨ÙŠØ¹ Ù†Ù‚Ø¯ÙŠ</button>
                                <button class="btn btn-warning btn-lg" onclick="showInstallmentModal()">ğŸ“… Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</button>
                                <button class="btn btn-info btn-lg" onclick="saveQuote()">ğŸ“„ Ø­ÙØ¸ ÙƒØ¹Ø±Ø¶ Ø³Ø¹Ø±</button>
                                <button class="btn btn-danger" onclick="clearCart()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¹Ø±Ø¨Ø©</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
            <div id="products" class="tab-content">
                <div class="panel-tabs">
                    <ul class="tabs-secondary">
                        <li><button class="tab-secondary active" onclick="showProductTab('product-list')">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button></li>
                        <li><button class="tab-secondary" onclick="showProductTab('add-product')">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</button></li>
                    </ul>
                </div>

                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div id="product-list" class="tab-pane active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                            <div class="quick-actions">
                                <button class="btn btn-success btn-sm" onclick="exportProducts()">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
                                <button class="btn btn-info btn-sm" onclick="showImportModal()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                                <button class="btn btn-primary btn-sm" onclick="showProductTab('add-product')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
                            </div>
                        </div>

                        <div class="filter-section">
                            <div class="filter-row">
                                <div class="form-group">
                                    <label>Ø§Ù„Ø¨Ø­Ø«</label>
                                    <input type="text" id="productFilterInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª..." oninput="filterProductsList()">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„ÙØ¦Ø©</label>
                                    <select id="categoryFilterProducts" onchange="filterProductsList()">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                    <select id="statusFilterProducts" onchange="filterProductsList()">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                                        <option value="active">Ù†Ø´Ø·</option>
                                        <option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option>
                                        <option value="low-stock">Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <table id="productsTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                                        <th>Ø§Ù„ÙØ¦Ø©</th>
                                        <th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                                        <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                                        <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
                <div id="add-product" class="tab-pane">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                        </div>
                        
                        <div class="product-form">
                            <div class="accordion">
                                <div class="accordion-header active" onclick="toggleAccordion(this)">
                                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                                </div>
                                <div class="accordion-content active">
                                    <div class="grid">
                                        <div class="form-group">
                                            <label class="required-field">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                                            <input type="text" id="productName" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
                                            <input type="text" id="productBarcode" placeholder="Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ØªÙØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹">
                                        </div>
                                        <div class="form-group">
                                            <label class="required-field">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
                                            <select id="mainCategory" onchange="updateSubCategories()" required>
                                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label>
                                            <select id="subCategory">
                                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-header active" onclick="toggleAccordion(this)">
                                    Ø§Ù„ØªØ³Ø¹ÙŠØ± ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†
                                </div>
                                <div class="accordion-content active">
                                    <div class="grid">
                                        <div class="form-group">
                                            <label class="required-field">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</label>
                                            <input type="number" id="costPrice" oninput="calculateProfitMargin()" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="required-field">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
                                            <input type="number" id="salePrice" oninput="calculateProfitMargin()" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)</label>
                                            <input type="number" id="profitMargin" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø¹Ø±</label>
                                            <input type="number" id="minPrice" value="0">
                                        </div>
                                        <div class="form-group">
                                            <label class="required-field">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                            <input type="number" id="productStock" required value="0">
                                        </div>
                                        <div class="form-group">
                                            <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                            <input type="number" id="minStock" value="5">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-header" onclick="toggleAccordion(this)">
                                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                                </div>
                                <div class="accordion-content">
                                    <div class="grid">
                                        <div class="form-group">
                                            <label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</label>
                                            <input type="text" id="productBrand">
                                        </div>
                                        <div class="form-group">
                                            <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
                                            <input type="text" id="productModel">
                                        </div>
                                        <div class="form-group">
                                            <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                                            <select id="supplierId">
                                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                                            <input type="date" id="expiryDate">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                                        <textarea id="productDescription" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                        <textarea id="productNotes" rows="2"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn btn-primary btn-lg" onclick="addProduct()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                                <button class="btn btn-danger" onclick="clearProductForm()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
            <div id="customers" class="tab-content">
                <div class="panel-tabs">
                    <ul class="tabs-secondary">
                        <li><button class="tab-secondary active" onclick="showCustomerTab('customer-list')">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button></li>
                        <li><button class="tab-secondary" onclick="showCustomerTab('add-customer')">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button></li>
                    </ul>
                </div>

                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
                <div id="customer-list" class="tab-pane active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                            <button class="btn btn-primary btn-sm" onclick="showCustomerTab('add-customer')">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
                        </div>
                        <div class="search-container">
                            <input type="text" id="customerSearch" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„..." oninput="searchCustomers()">
                            <span class="search-icon">ğŸ”</span>
                        </div>
                        <div class="table-container">
                            <table id="customersTable">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                        <th>Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</th>
                                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</th>
                                        <th>Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTableBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ -->
                <div id="add-customer" class="tab-pane">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
                        </div>
                        <div class="grid">
                            <div class="form-group">
                                <label class="required-field">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input type="text" id="customerFullName" required>
                            </div>
                            <div class="form-group">
                                <label class="required-field">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="customerPhone" required>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="customerEmail">
                            </div>
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <select id="customerType">
                                    <option value="regular">Ø¹Ø§Ø¯ÙŠ</option>
                                    <option value="vip">Ù…Ù…ÙŠØ²</option>
                                    <option value="wholesale">ØªØ§Ø¬Ø± Ø¬Ù…Ù„Ø©</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <textarea id="customerAddress" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea id="customerNotes" rows="2"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="addCustomer()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
                            <button class="btn btn-danger" onclick="clearCustomerForm()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
            <div id="suppliers" class="tab-content">
                <div class="panel-tabs">
                    <ul class="tabs-secondary">
                        <li><button class="tab-secondary active" onclick="showSupplierTab('supplier-list')">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button></li>
                        <li><button class="tab-secondary" onclick="showSupplierTab('add-supplier')">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</button></li>
                    </ul>
                </div>

                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
                <div id="supplier-list" class="tab-pane active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h3>
                            <button class="btn btn-primary btn-sm" onclick="showSupplierTab('add-supplier')">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯</button>
                        </div>
                        <div class="search-container">
                            <input type="text" id="supplierSearch" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ±Ø¯..." oninput="searchSuppliers()">
                            <span class="search-icon">ğŸ”</span>
                        </div>
                        <div class="table-container">
                            <table id="suppliersTable">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
                                        <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                        <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                        <th>Ø¢Ø®Ø± Ø·Ù„Ø¨ÙŠØ©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="suppliersTableBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ -->
                <div id="add-supplier" class="tab-pane">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸšš Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
                        </div>
                        <div class="grid">
                            <div class="form-group">
                                <label class="required-field">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
                                <input type="text" id="supplierCompany" required>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                                <input type="text" id="supplierContact">
                            </div>
                            <div class="form-group">
                                <label class="required-field">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="supplierPhone" required>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="supplierEmail">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <textarea id="supplierAddress" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea id="supplierNotes" rows="2"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="addSupplier()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯</button>
                            <button class="btn btn-danger" onclick="clearSupplierForm()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
            <div id="dashboard" class="tab-content">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="todaySales">0</div>
                        <div class="stat-label">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                        <div class="stat-change">+12% Ù…Ù† Ø£Ù…Ø³</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="monthSales">0</div>
                        <div class="stat-label">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±</div>
                        <div class="stat-change">+8% Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                        <div class="stat-change">ØªÙ… Ø¥Ø¶Ø§ÙØ© 5 Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lowStockAlert">0</div>
                        <div class="stat-label">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
                        <div class="stat-change">ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¬Ø¯ÙŠØ¯</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeCustomers">0</div>
                        <div class="stat-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</div>
                        <div class="stat-change">+15 Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingInstallments">0</div>
                        <div class="stat-label">Ø£Ù‚Ø³Ø§Ø· Ù…Ø¹Ù„Ù‚Ø©</div>
                        <div class="stat-change">Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“ˆ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                        </div>
                        <div class="analytics-chart">
                            <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù‡Ù†Ø§</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                        </div>
                        <div id="alertsList">
                            <div class="alert alert-warning">âš ï¸ Ù…Ù†ØªØ¬ "Ù„Ø§Ø¨ØªÙˆØ¨ Ø¯ÙŠÙ„" ÙˆØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</div>
                            <div class="alert alert-info">â„¹ï¸ Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù‚Ø³Ø· Ø§Ù„Ø¹Ù…ÙŠÙ„ "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" ØºØ¯Ø§Ù‹</div>
                            <div class="alert alert-success">âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø´Ø­Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ "Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©"</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ† Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
                    </div>
                    <div class="table-container">
                        <table id="topProductsTable">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</th>
                                    <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
                                    <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                </tr>
                            </thead>
                            <tbody id="topProductsBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
            <div id="sales" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                    </div>
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="form-group">
                                <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="salesFromDate">
                            </div>
                            <div class="form-group">
                                <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="salesToDate">
                            </div>
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹</label>
                                <select id="saleTypeFilter">
                                    <option value="">Ø§Ù„ÙƒÙ„</option>
                                    <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                                    <option value="installment">Ø£Ù‚Ø³Ø§Ø·</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label></label>
                                <button class="btn btn-primary" onclick="filterSales()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="salesTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                    <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹</th>
                                    <th>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ø· -->
            <div id="installments" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</h3>
                    </div>
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="form-group">
                                <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø³Ø·</label>
                                <select id="installmentStatusFilter">
                                    <option value="">Ø§Ù„ÙƒÙ„</option>
                                    <option value="pending">Ù…Ø¹Ù„Ù‚</option>
                                    <option value="paid">Ù…Ø¯ÙÙˆØ¹</option>
                                    <option value="overdue">Ù…ØªØ£Ø®Ø±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <select id="installmentCustomerFilter">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label></label>
                                <button class="btn btn-primary" onclick="filterInstallments()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="installmentsTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="installmentsTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª -->
            <div id="returns" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">â†©ï¸ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</h3>
                        <button class="btn btn-warning btn-sm" onclick="showNewReturnModal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±ØªØ¬Ø¹</button>
                    </div>
                    <div class="table-container">
                        <table id="returnsTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ØªØ¬Ø¹</th>
                                    <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
                                    <th>Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="returnsTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
            <div id="expenses" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                        <button class="btn btn-warning btn-sm" onclick="showNewExpenseModal()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
                    </div>
                    <div class="table-container">
                        <table id="expensesTable">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„ÙˆØµÙ</th>
                                    <th>Ø§Ù„ÙØ¦Ø©</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <div id="reports" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“‹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
                    </div>
                    <div class="grid">
                        <div class="card">
                            <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                            <p>Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                            <button class="btn btn-primary" onclick="generateSalesReport()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                        </div>
                        <div class="card">
                            <h3>ğŸ“¦ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
                            <p>Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©</p>
                            <button class="btn btn-primary" onclick="generateInventoryReport()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                        </div>
                        <div class="card">
                            <h3>ğŸ’° ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
                            <p>Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±</p>
                            <button class="btn btn-primary" onclick="generateProfitReport()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                        </div>
                        <div class="card">
                            <h3>ğŸ‘¥ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                            <p>Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø±Ø§Ø¡Ù‹</p>
                            <button class="btn btn-primary" onclick="generateCustomerReport()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <div id="settings" class="tab-content">
                <div class="tabs-secondary">
                    <button class="tab-secondary active" onclick="showSettingsTab('general')">Ø¹Ø§Ù…</button>
                    <button class="tab-secondary" onclick="showSettingsTab('pos')">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
                    <button class="tab-secondary" onclick="showSettingsTab('backup')">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
                </div>

                <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
                <div id="general-settings" class="settings-content active">
                    <div class="grid">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">ğŸª Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
                                <input type="text" id="storeName" value="Ù…ØªØ¬Ø±ÙŠ">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                                <textarea id="storeAddress" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="storePhone">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="storeEmail">
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">ğŸŒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠØ©</h3>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                                <select id="currency">
                                    <option value="IQD">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ (Ø¯.Ø¹)</option>
                                    <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ ($)</option>
                                    <option value="EUR">ÙŠÙˆØ±Ùˆ (â‚¬)</option>
                                    <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (Ø±.Ø³)</option>
                                    <option value="AED">Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ (Ø¯.Ø¥)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ù„ØºØ©</label>
                                <select id="language">
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                <select id="dateFormat">
                                    <option value="DD/MM/YYYY">ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©</option>
                                    <option value="MM/DD/YYYY">Ø´Ù‡Ø±/ÙŠÙˆÙ…/Ø³Ù†Ø©</option>
                                    <option value="YYYY-MM-DD">Ø³Ù†Ø©-Ø´Ù‡Ø±-ÙŠÙˆÙ…</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
                <div id="pos-settings" class="settings-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ’° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h3>
                        </div>
                        <div class="grid">
                            <div class="form-group">
                                <label>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (%)</label>
                                <input type="number" id="defaultTaxRate" value="0" min="0" max="50">
                            </div>
                            <div class="form-group">
                                <label>Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø£Ù‚Ø³Ø§Ø· (%)</label>
                                <input type="number" id="defaultInterestRate" value="5" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
                                <input type="number" id="defaultInstallments" value="12" min="1" max="60">
                            </div>
                            <div class="form-group">
                                <label>Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
                                <select id="showProductImage">
                                    <option value="1">Ù†Ø¹Ù…</option>
                                    <option value="0">Ù„Ø§</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    </div>
                </div>

                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
                <div id="backup-settings" class="settings-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                        </div>
                        <div class="grid">
                            <div class="card">
                                <h3>ğŸ“¤ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h3>
                                <p>Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                                <button class="btn btn-primary" onclick="createBackup()">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                            </div>
                            <div class="card">
                                <h3>ğŸ“¥ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h3>
                                <p>Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³Ø§Ø¨Ù‚</p>
                                <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="restoreBackup(this)">
                                <button class="btn btn-warning" onclick="document.getElementById('backupFile').click()">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customerModal')">&times;</span>
            <h2>Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„</h2>
            <div class="search-container">
                <input type="text" id="customerModalSearch" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„..." oninput="searchCustomersModal()">
                <span class="search-icon">ğŸ”</span>
            </div>
            <div id="customersList" style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="showCustomerTab('add-customer'); closeModal('customerModal')">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· -->
    <div id="installmentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('installmentModal')">&times;</span>
            <h2>Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</h2>
            <div id="installmentContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div id="invoiceDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('invoiceDetailsModal')">&times;</span>
            <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h2>
            <div id="invoiceContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editProductModal')">&times;</span>
            <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
            <div id="editProductContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let suppliers = JSON.parse(localStorage.getItem('suppliers')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        let installmentSales = JSON.parse(localStorage.getItem('installmentSales')) || [];
        let returns = JSON.parse(localStorage.getItem('returns')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let cart = [];
        let selectedCustomer = null;
        let settings = JSON.parse(localStorage.getItem('settings')) || {};
        let currentEditProductId = null;

        // Ø§Ù„ÙØ¦Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
        const categoryStructure = {
            electronics: {
                name: 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',
                subcategories: ['Ù‡ÙˆØ§ØªÙ Ø°ÙƒÙŠØ©', 'Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ…Ø¨ÙŠÙˆØªØ±', 'ØªÙ„ÙØ²ÙŠÙˆÙ†Ø§Øª', 'Ø£Ø¬Ù‡Ø²Ø© ØµÙˆØª', 'ÙƒØ§Ù…ÙŠØ±Ø§Øª', 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª']
            },
            clothes: {
                name: 'Ù…Ù„Ø§Ø¨Ø³',
                subcategories: ['Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠ', 'Ù…Ù„Ø§Ø¨Ø³ Ù†Ø³Ø§Ø¦ÙŠ', 'Ù…Ù„Ø§Ø¨Ø³ Ø£Ø·ÙØ§Ù„', 'Ø£Ø­Ø°ÙŠØ©', 'Ø­Ù‚Ø§Ø¦Ø¨', 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª']
            },
            food: {
                name: 'Ø·Ø¹Ø§Ù… ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª',
                subcategories: ['Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©', 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª', 'Ø­Ù„ÙˆÙŠØ§Øª', 'Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¬Ù…Ø¯Ø©', 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', 'Ù„Ø­ÙˆÙ…']
            },
            health: {
                name: 'ØµØ­Ø© ÙˆØ¬Ù…Ø§Ù„',
                subcategories: ['Ø£Ø¯ÙˆÙŠØ©', 'Ù…Ø³ØªØ­Ø¶Ø±Ø§Øª ØªØ¬Ù…ÙŠÙ„', 'Ø¹Ù†Ø§ÙŠØ© Ø´Ø®ØµÙŠØ©', 'ÙÙŠØªØ§Ù…ÙŠÙ†Ø§Øª', 'Ø£Ø¹Ø´Ø§Ø¨ Ø·Ø¨ÙŠØ©', 'Ø£Ø¬Ù‡Ø²Ø© Ø·Ø¨ÙŠØ©']
            },
            home: {
                name: 'Ù…Ù†Ø²Ù„ ÙˆØ­Ø¯ÙŠÙ‚Ø©',
                subcategories: ['Ø£Ø«Ø§Ø«', 'Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©', 'Ø¯ÙŠÙƒÙˆØ±', 'Ø£Ø¯ÙˆØ§Øª Ø­Ø¯ÙŠÙ‚Ø©', 'Ø¥Ø¶Ø§Ø¡Ø©', 'Ù…Ù†Ø³ÙˆØ¬Ø§Øª']
            },
            sports: {
                name: 'Ø±ÙŠØ§Ø¶Ø©',
                subcategories: ['Ù…Ù„Ø§Ø¨Ø³ Ø±ÙŠØ§Ø¶ÙŠØ©', 'Ø£Ø¬Ù‡Ø²Ø© ØªÙ…Ø§Ø±ÙŠÙ†', 'ÙƒØ±Ø© Ù‚Ø¯Ù…', 'ÙƒØ±Ø© Ø³Ù„Ø©', 'Ø³Ø¨Ø§Ø­Ø©', 'Ø±ÙŠØ§Ø¶Ø§Øª Ø£Ø®Ø±Ù‰']
            },
            books: {
                name: 'ÙƒØªØ¨',
                subcategories: ['ÙƒØªØ¨ Ø¯ÙŠÙ†ÙŠØ©', 'ÙƒØªØ¨ Ø¹Ù„Ù…ÙŠØ©', 'Ø±ÙˆØ§ÙŠØ§Øª', 'ÙƒØªØ¨ Ø£Ø·ÙØ§Ù„', 'Ù‚ÙˆØ§Ù…ÙŠØ³', 'Ù…Ø¬Ù„Ø§Øª']
            },
            toys: {
                name: 'Ø£Ù„Ø¹Ø§Ø¨',
                subcategories: ['Ø£Ù„Ø¹Ø§Ø¨ ØªØ¹Ù„ÙŠÙ…ÙŠØ©', 'Ø£Ù„Ø¹Ø§Ø¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', 'Ø¯Ù…Ù‰', 'Ø£Ù„Ø¹Ø§Ø¨ Ø±ÙŠØ§Ø¶ÙŠØ©', 'Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ù†Ø§Ø¡', 'Ø£Ù„Ø¹Ø§Ø¨ ÙÙ†ÙŠØ©']
            },
            automotive: {
                name: 'Ø³ÙŠØ§Ø±Ø§Øª',
                subcategories: ['Ù‚Ø·Ø¹ ØºÙŠØ§Ø±', 'Ø²ÙŠÙˆØª ÙˆÙ…ÙˆØ§Ø¯ Ø§Ù„ØªØ´Ø­ÙŠÙ…', 'Ø¥Ø·Ø§Ø±Ø§Øª', 'Ø¨Ø·Ø§Ø±ÙŠØ§Øª', 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'Ø£Ø¯ÙˆØ§Øª']
            },
            jewelry: {
                name: 'Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª',
                subcategories: ['Ø°Ù‡Ø¨', 'ÙØ¶Ø©', 'Ø£Ù„Ù…Ø§Ø³', 'Ø³Ø§Ø¹Ø§Øª', 'Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª Ù…Ù‚Ù„Ø¯Ø©', 'Ù‡Ø¯Ø§ÙŠØ§']
            }
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = function() {
            updateLiveTime();
            setInterval(updateLiveTime, 1000);
            loadAllData();
            loadCategories();
            applySettings();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ ÙƒØªØ¨ÙˆÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ
            showTab('pos');
        };

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        function updateLiveTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ar-IQ', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('liveTime').textContent = timeString;
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName).classList.add('active');
            document.getElementById('btn-' + tabName).classList.add('active');

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            switch(tabName) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'pos':
                    loadProductsForPOS();
                    updateCartDisplay();
                    break;
                case 'products':
                    loadProductsTable();
                    break;
                case 'customers':
                    loadCustomersTable();
                    break;
                case 'suppliers':
                    loadSuppliersTable();
                    break;
                case 'sales':
                    loadSalesTable();
                    break;
                case 'installments':
                    loadInstallmentsTable();
                    break;
                case 'returns':
                    loadReturnsTable();
                    break;
                case 'expenses':
                    loadExpensesTable();
                    break;
            }
        }

        // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ©
        function showProductTab(tabName) {
            const tabs = document.querySelectorAll('#products .tab-pane');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('#products .tab-secondary');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`button[onclick="showProductTab('${tabName}')"]`).classList.add('active');
            
            if (tabName === 'product-list') {
                loadProductsTable();
            }
        }

        function showCustomerTab(tabName) {
            const tabs = document.querySelectorAll('#customers .tab-pane');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('#customers .tab-secondary');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`button[onclick="showCustomerTab('${tabName}')"]`).classList.add('active');
            
            if (tabName === 'customer-list') {
                loadCustomersTable();
            }
        }

        function showSupplierTab(tabName) {
            const tabs = document.querySelectorAll('#suppliers .tab-pane');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('#suppliers .tab-secondary');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`button[onclick="showSupplierTab('${tabName}')"]`).classList.add('active');
            
            if (tabName === 'supplier-list') {
                loadSuppliersTable();
            }
        }

        function showSettingsTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.settings-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-secondary').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName + '-settings').classList.add('active');
            event.target.classList.add('active');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function loadAllData() {
            loadProductsForPOS();
            loadProductsTable();
            loadCustomersTable();
            loadSuppliersTable();
            loadSalesTable();
            loadInstallmentsTable();
            updateDashboard();
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function updateDashboard() {
            // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
            const today = new Date().toDateString();
            const todaySales = sales
                .filter(sale => new Date(sale.date).toDateString() === today)
                .reduce((sum, sale) => sum + sale.total, 0);

            // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthSales = sales
                .filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate.getMonth() === thisMonth && saleDate.getFullYear() === thisYear;
                })
                .reduce((sum, sale) => sum + sale.total, 0);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('todaySales').textContent = formatCurrency(todaySales);
            document.getElementById('monthSales').textContent = formatCurrency(monthSales);
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('lowStockAlert').textContent = products.filter(p => p.productStock <= (p.minStock || 5)).length;
            document.getElementById('activeCustomers').textContent = customers.length;
            document.getElementById('pendingInstallments').textContent = installmentSales.filter(s => s.status === 'active').length;
            
            // ØªØ­Ù…ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            loadTopProducts();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function loadTopProducts() {
            const tbody = document.getElementById('topProductsBody');
            tbody.innerHTML = '';
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©
            const soldProducts = {};
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (!soldProducts[item.id]) {
                        soldProducts[item.id] = {
                            id: item.id,
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    soldProducts[item.id].quantity += item.quantity;
                    soldProducts[item.id].revenue += item.price * item.quantity * (1 - item.discount / 100);
                });
            });
            
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆØªØ±ØªÙŠØ¨
            const topProducts = Object.values(soldProducts)
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 5);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù†Ø³Ø¨ Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
            const totalRevenue = topProducts.reduce((sum, product) => sum + product.revenue, 0);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            topProducts.forEach(product => {
                const percentage = totalRevenue > 0 ? (product.revenue / totalRevenue * 100).toFixed(1) : 0;
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.quantity}</td>
                    <td class="currency">${formatCurrency(product.revenue)}</td>
                    <td>${percentage}%</td>
                `;
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
function loadProductsForPOS() {
    const productGrid = document.getElementById('productGrid');
    productGrid.innerHTML = '';

    if (products.length === 0) {
        productGrid.innerHTML = '<div class="centered-content"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.</p></div>';
        return;
    }

    // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©
    let filteredProducts = filterProductsForPOS();
    
    if (filteredProducts.length === 0) {
        productGrid.innerHTML = '<div class="centered-content"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«.</p></div>';
        return;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©
    filteredProducts.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.onclick = () => addToCart(product);
        
        // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        let stockStatus, stockClass;
        if (product.productStock <= 0) {
            stockStatus = 'Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†';
            stockClass = 'status-out-of-stock';
        } else if (product.productStock <= (product.minStock || 5)) {
            stockStatus = 'Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶';
            stockClass = 'status-low-stock';
        } else {
            stockStatus = 'Ù…ØªÙˆÙØ±';
            stockClass = 'status-active';
        }
        
        productCard.innerHTML = `
            <div class="product-image">ğŸ“¦</div>
            <div class="product-info">
                <h4>${product.name}</h4>
                <p class="product-price">${formatCurrency(product.salePrice)}</p>
                <p>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${product.productStock}</p>
                <span class="status-badge ${stockClass}">${stockStatus}</span>
            </div>
        `;

        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØµÙØ±
        if (product.productStock <= 0) {
            productCard.style.opacity = '0.6';
            productCard.style.cursor = 'not-allowed';
            productCard.onclick = () => showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'error');
        }

        productGrid.appendChild(productCard);
    });
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
function filterProductsForPOS() {
    const searchTerm = document.getElementById('productSearch').value.toLowerCase();
    const categoryFilter = document.getElementById('categoryFilter').value;
    const priceRange = document.getElementById('priceRange').value;
    const stockFilter = document.getElementById('stockFilter').value;
    
    return products.filter(product => {
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
        const nameMatch = product.name.toLowerCase().includes(searchTerm);
        const barcodeMatch = product.barcode && product.barcode.toLowerCase().includes(searchTerm);
        const searchMatch = nameMatch || barcodeMatch;
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
        const categoryMatch = !categoryFilter || product.mainCategory === categoryFilter;
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±
        let priceMatch = true;
        if (priceRange) {
            const price = product.salePrice;
            if (priceRange === '0-50000') priceMatch = price < 50000;
            else if (priceRange === '50000-200000') priceMatch = price >= 50000 && price <= 200000;
            else if (priceRange === '200000-500000') priceMatch = price >= 200000 && price <= 500000;
            else if (priceRange === '500000+') priceMatch = price > 500000;
        }
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        let stockMatch = true;
        if (stockFilter) {
            if (stockFilter === 'available') stockMatch = product.productStock > (product.minStock || 5);
            else if (stockFilter === 'low') stockMatch = product.productStock > 0 && product.productStock <= (product.minStock || 5);
            else if (stockFilter === 'out') stockMatch = product.productStock <= 0;
        }
        
        return searchMatch && categoryMatch && priceMatch && stockMatch;
    });
}

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function searchProducts() {
    loadProductsForPOS();
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function filterProducts() {
    loadProductsForPOS();
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©
function addToCart(product) {
    if (product.productStock <= 0) {
        showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'error');
        return;
    }

    const existingItem = cart.find(item => item.id === product.id);
    
    if (existingItem) {
        if (existingItem.quantity < product.productStock) {
            existingItem.quantity++;
            showNotification(`ØªÙ… Ø²ÙŠØ§Ø¯Ø© ÙƒÙ…ÙŠØ© ${product.name}`, 'success');
        } else {
            showNotification('Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'error');
            return;
        }
    } else {
        cart.push({
            id: product.id,
            name: product.name,
            price: product.salePrice,
            quantity: 1,
            discount: 0,
            maxStock: product.productStock,
            costPrice: product.costPrice || 0
        });
        showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${product.name} Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©`, 'success');
    }
    
    updateCartDisplay();
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±Ø¨Ø©
function updateCartDisplay() {
    const tbody = document.getElementById('cartItems');
    tbody.innerHTML = '';
    
    if (cart.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø©</td></tr>';
        updateCartTotal();
        return;
    }
    
    cart.forEach((item, index) => {
        const itemTotal = (item.price * item.quantity) * (1 - item.discount / 100);
        
        const row = tbody.insertRow();
        row.innerHTML = `
            <td>${item.name}</td>
            <td>
                <div class="cart-item-actions">
                    <button onclick="changeQuantity(${index}, -1)" class="btn btn-sm">-</button>
                    <span class="cart-quantity">${item.quantity}</span>
                    <button onclick="changeQuantity(${index}, 1)" class="btn btn-sm">+</button>
                </div>
            </td>
            <td class="currency">${formatCurrency(item.price)}</td>
            <td>
                <input type="number" value="${item.discount}" min="0" max="100" 
                       onchange="updateItemDiscount(${index}, this.value)"
                       style="width: 70px;">%
            </td>
            <td class="currency">${formatCurrency(itemTotal)}</td>
            <td><button onclick="removeFromCart(${index})" class="btn btn-danger btn-sm">ğŸ—‘ï¸</button></td>
        `;
    });
    
    updateCartTotal();
}

// ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø©
function updateCartTotal() {
    const subtotal = getSubtotal();
    
    const discountRate = parseFloat(document.getElementById('totalDiscount').value) || 0;
    const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
    
    const discountAmount = subtotal * (discountRate / 100);
    const afterDiscount = subtotal - discountAmount;
    const taxAmount = afterDiscount * (taxRate / 100);
    const total = afterDiscount + taxAmount;

    document.getElementById('subtotal').textContent = formatCurrency(subtotal);
    document.getElementById('discountAmount').textContent = formatCurrency(discountAmount);
    document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
    document.getElementById('totalAmount').textContent = formatCurrency(total);
}

// ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø©
function changeQuantity(index, change) {
    const item = cart[index];
    const newQuantity = item.quantity + change;
    
    if (newQuantity <= 0) {
        removeFromCart(index);
        return;
    }
    
    if (newQuantity > item.maxStock) {
        showNotification('Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'error');
        return;
    }
    
    item.quantity = newQuantity;
    updateCartDisplay();
    showNotification(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ…ÙŠØ© ${item.name} Ø¥Ù„Ù‰ ${newQuantity}`, 'success');
}

// ØªØ­Ø¯ÙŠØ« Ø®ØµÙ… Ø§Ù„Ø¹Ù†ØµØ±
function updateItemDiscount(index, discount) {
    cart[index].discount = parseFloat(discount) || 0;
    updateCartDisplay();
}

// Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©
function removeFromCart(index) {
    const removedItem = cart[index];
    cart.splice(index, 1);
    updateCartDisplay();
    showNotification(`ØªÙ… Ø­Ø°Ù ${removedItem.name} Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©`, 'success');
}

// Ù…Ø³Ø­ Ø§Ù„Ø¹Ø±Ø¨Ø©
function clearCart() {
    if (cart.length === 0) return;
    
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©ØŸ')) {
        cart = [];
        updateCartDisplay();
        showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¹Ø±Ø¨Ø©', 'success');
    }
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
function processCashSale() {
    if (cart.length === 0) {
        showNotification('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©', 'error');
        return;
    }

    const total = getTotalAmount();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    const updatedProducts = [...products];
    cart.forEach(cartItem => {
        const productIndex = updatedProducts.findIndex(p => p.id === cartItem.id);
        if (productIndex !== -1) {
            updatedProducts[productIndex].productStock -= cartItem.quantity;
        }
    });

    // ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· ÙˆÙ„Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„
    if (selectedCustomer) {
        const customerIndex = customers.findIndex(c => c.id === selectedCustomer.id);
        if (customerIndex !== -1) {
            customers[customerIndex].loyaltyPoints = (customers[customerIndex].loyaltyPoints || 0) + Math.floor(total / 1000); // Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ 1000 Ø¯.Ø¹
            customers[customerIndex].totalPurchases = (customers[customerIndex].totalPurchases || 0) + total;
            customers[customerIndex].lastVisit = new Date().toISOString();
            localStorage.setItem('customers', JSON.stringify(customers));
        }
    }

    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©
    const totalCost = cart.reduce((sum, item) => sum + (item.costPrice * item.quantity), 0);
    const profit = total - totalCost;

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹
    const sale = {
        id: Date.now(),
        invoiceNumber: generateInvoiceNumber(),
        customerId: selectedCustomer?.id || null,
        customerName: selectedCustomer?.fullName || 'Ø¹Ù…ÙŠÙ„ Ù…Ø¬Ù‡ÙˆÙ„',
        items: JSON.parse(JSON.stringify(cart)), // Ù†Ø³Ø®Ø© Ø¹Ù…ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©
        subtotal: getSubtotal(),
        discount: getTotalDiscount(),
        tax: getTaxAmount(),
        total: total,
        cost: totalCost,
        profit: profit,
        type: 'cash',
        date: new Date().toISOString(),
        cashier: document.getElementById('currentUser').textContent.replace('ğŸ‘¤ ', '') || 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
    };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    sales.push(sale);
    products = updatedProducts;
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    localStorage.setItem('sales', JSON.stringify(sales));
    localStorage.setItem('products', JSON.stringify(products));
    
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ø±Ø¨Ø© ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„
    clearCart();
    clearSelectedCustomer();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadProductsForPOS();
    updateDashboard();
    
    showNotification('ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    printReceipt(sale);
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
function printReceipt(sale) {
    const receiptWindow = window.open('', '_blank');
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const storeName = settings.storeName || 'Ù…ØªØ¬Ø±ÙŠ';
    const storeAddress = settings.storeAddress || '';
    const storePhone = settings.storePhone || '';
    
    const receiptHTML = `
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¨ÙŠØ¹</title>
            <style>
                body { 
                    font-family: 'Courier New', monospace; 
                    width: 300px; 
                    margin: 0 auto; 
                    padding: 10px;
                }
                .receipt-header, .receipt-footer { 
                    text-align: center; 
                    margin: 10px 0; 
                    padding: 5px; 
                    border-bottom: 1px dashed #000; 
                }
                .receipt-footer { 
                    border-top: 1px dashed #000; 
                    border-bottom: none; 
                }
                .item { 
                    display: flex; 
                    justify-content: space-between; 
                    margin: 5px 0; 
                }
                .receipt-total { 
                    font-weight: bold; 
                    text-align: right; 
                    border-top: 1px dashed #000; 
                    margin-top: 10px; 
                    padding-top: 10px; 
                }
                .print-button { 
                    display: block; 
                    margin: 20px auto; 
                    padding: 10px; 
                    background: #4CAF50; 
                    color: white; 
                    border: none; 
                    border-radius: 5px; 
                    cursor: pointer; 
                }
                @media print {
                    .print-button { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="receipt">
                <div class="receipt-header">
                    <h2>${storeName}</h2>
                    ${storeAddress ? `<p>${storeAddress}</p>` : ''}
                    ${storePhone ? `<p>Ù‡Ø§ØªÙ: ${storePhone}</p>` : ''}
                    <p>ØªØ§Ø±ÙŠØ®: ${new Date(sale.date).toLocaleDateString('ar-IQ')}</p>
                    <p>Ø§Ù„ÙˆÙ‚Øª: ${new Date(sale.date).toLocaleTimeString('ar-IQ')}</p>
                    <p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${sale.invoiceNumber || sale.id}</p>
                    <p>Ø§Ù„Ø¹Ù…ÙŠÙ„: ${sale.customerName}</p>
                </div>
                <div class="receipt-items">
                    ${sale.items.map(item => `
                        <div class="item">
                            <div>
                                <span>${item.name} Ã— ${item.quantity}</span>
                                ${item.discount > 0 ? `<br><small>Ø®ØµÙ…: ${item.discount}%</small>` : ''}
                            </div>
                            <span>${formatCurrency(item.price * item.quantity * (1 - item.discount / 100))}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="receipt-total">
                    <div class="item">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                        <span>${formatCurrency(sale.subtotal)}</span>
                    </div>
                    ${sale.discount > 0 ? `
                        <div class="item">
                            <span>Ø§Ù„Ø®ØµÙ…:</span>
                            <span>${formatCurrency(sale.discount)}</span>
                        </div>
                    ` : ''}
                    ${sale.tax > 0 ? `
                        <div class="item">
                            <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                            <span>${formatCurrency(sale.tax)}</span>
                        </div>
                    ` : ''}
                    <div class="item" style="font-weight: bold; font-size: 1.2em;">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span>${formatCurrency(sale.total)}</span>
                    </div>
                </div>
                <div class="receipt-footer">
                    <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³ÙˆÙ‚ÙƒÙ… Ù…Ø¹Ù†Ø§</p>
                    ${settings.receiptFooter ? `<p>${settings.receiptFooter}</p>` : ''}
                </div>
            </div>
            <button class="print-button" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</button>
        </body>
        </html>
    `;
    
    receiptWindow.document.write(receiptHTML);
    receiptWindow.document.close();
}

// Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function showInstallmentModal() {
    if (cart.length === 0) {
        showNotification('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©', 'error');
        return;
    }

    if (!selectedCustomer) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
    }

    const total = getTotalAmount();
    const defaultInterestRate = settings.defaultInterestRate || 5;
    const defaultInstallments = settings.defaultInstallments || 12;
    
    // Ø¥Ù†Ø´Ø§Ø¡ ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø· (Ø¨Ø¹Ø¯ Ø´Ù‡Ø± Ù…Ù† Ø§Ù„ÙŠÙˆÙ…)
    const firstPaymentDate = new Date();
    firstPaymentDate.setMonth(firstPaymentDate.getMonth() + 1);
    const formattedFirstPaymentDate = firstPaymentDate.toISOString().split('T')[0];
    
    document.getElementById('installmentModal').style.display = 'block';
    
    // Ù…Ù„Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    const modalContent = document.getElementById('installmentContent');
    modalContent.innerHTML = `
        <div class="card">
            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${selectedCustomer.fullName}</p>
            <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${selectedCustomer.phone}</p>
            <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${
                selectedCustomer.type === 'vip' ? 'Ù…Ù…ÙŠØ²' : 
                selectedCustomer.type === 'wholesale' ? 'ØªØ§Ø¬Ø± Ø¬Ù…Ù„Ø©' : 
                'Ø¹Ø§Ø¯ÙŠ'
            }</p>
        </div>

        <div class="grid">
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</label>
                <input type="number" id="originalAmount" value="${total}" readonly>
            </div>
            <div class="form-group">
                <label>Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© (%)</label>
                <input type="number" id="interestRate" value="${defaultInterestRate}" 
                       min="0" max="50" step="0.1" oninput="calculateInstallments()">
            </div>
            <div class="form-group">
                <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø´Ù‡Ø±)</label>
                <input type="number" id="installmentCount" value="${defaultInstallments}" 
                       min="1" max="60" oninput="calculateInstallments()">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ø¹ Ø§Ù„ÙØ§Ø¦Ø¯Ø©</label>
                <input type="number" id="totalWithInterest" readonly>
            </div>
            <div class="form-group">
                <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                <input type="number" id="monthlyPayment" readonly>
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø·</label>
                <input type="date" id="firstPaymentDate" value="${formattedFirstPaymentDate}">
            </div>
        </div>

        <div id="installmentSchedule" class="installment-table"></div>
        
        <div style="margin-top: 20px;">
            <button class="btn btn-success btn-lg" onclick="createInstallmentSale()">ğŸ’¾ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</button>
            <button class="btn btn-danger" onclick="closeModal('installmentModal')">âŒ Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    `;

    calculateInstallments();
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function calculateInstallments() {
    const originalAmount = parseFloat(document.getElementById('originalAmount').value) || 0;
    const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
    const installmentCount = parseInt(document.getElementById('installmentCount').value) || 1;

    const totalWithInterest = originalAmount + (originalAmount * interestRate / 100);
    const monthlyPayment = totalWithInterest / installmentCount;

    document.getElementById('totalWithInterest').value = totalWithInterest.toFixed(2);
    document.getElementById('monthlyPayment').value = monthlyPayment.toFixed(2);

    displayInstallmentSchedule(totalWithInterest, monthlyPayment, installmentCount);
}

// Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function displayInstallmentSchedule(totalAmount, monthlyPayment, count) {
    const scheduleDiv = document.getElementById('installmentSchedule');
    const firstPaymentDate = new Date(document.getElementById('firstPaymentDate').value || Date.now());
    
    let scheduleHTML = `
        <h4>ğŸ“… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</h4>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù‚Ø³Ø·</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody>
    `;

    for (let i = 1; i <= count; i++) {
        const dueDate = new Date(firstPaymentDate);
        dueDate.setMonth(dueDate.getMonth() + i - 1);
        
        scheduleHTML += `
            <tr>
                <td>${i}</td>
                <td>${dueDate.toLocaleDateString('ar-IQ')}</td>
                <td class="currency">${formatCurrency(monthlyPayment)}</td>
                <td><span class="status-badge status-pending">Ù…Ø¹Ù„Ù‚</span></td>
            </tr>
        `;
    }

    scheduleHTML += '</tbody></table></div>';
    scheduleDiv.innerHTML = scheduleHTML;
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function createInstallmentSale() {
    const originalAmount = parseFloat(document.getElementById('originalAmount').value);
    const interestRate = parseFloat(document.getElementById('interestRate').value);
    const installmentCount = parseInt(document.getElementById('installmentCount').value);
    const totalWithInterest = parseFloat(document.getElementById('totalWithInterest').value);
    const monthlyPayment = parseFloat(document.getElementById('monthlyPayment').value);
    const firstPaymentDate = document.getElementById('firstPaymentDate').value;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    const installments = [];
    const startDate = new Date(firstPaymentDate);
    
    for (let i = 1; i <= installmentCount; i++) {
        const dueDate = new Date(startDate);
        dueDate.setMonth(dueDate.getMonth() + i - 1);
        
        installments.push({
            number: i,
            amount: monthlyPayment,
            dueDate: dueDate.toISOString(),
            paid: false,
            paidDate: null,
            paidAmount: 0,
            status: 'pending'
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    const updatedProducts = [...products];
    cart.forEach(cartItem => {
        const productIndex = updatedProducts.findIndex(p => p.id === cartItem.id);
        if (productIndex !== -1) {
            updatedProducts[productIndex].productStock -= cartItem.quantity;
        }
    });

    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
    const customerIndex = customers.findIndex(c => c.id === selectedCustomer.id);
    if (customerIndex !== -1) {
        customers[customerIndex].totalPurchases = (customers[customerIndex].totalPurchases || 0) + totalWithInterest;
        customers[customerIndex].lastVisit = new Date().toISOString();
    }

    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©
    const totalCost = cart.reduce((sum, item) => sum + (item.costPrice * item.quantity), 0);
    const profit = totalWithInterest - totalCost;

    // Ø­ÙØ¸ Ø¨ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    const installmentSale = {
        id: Date.now(),
        invoiceNumber: generateInvoiceNumber(),
        customerId: selectedCustomer.id,
        customerName: selectedCustomer.fullName,
        customerPhone: selectedCustomer.phone,
        items: JSON.parse(JSON.stringify(cart)), // Ù†Ø³Ø®Ø© Ø¹Ù…ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©
        originalAmount,
        interestRate,
        totalWithInterest,
        monthlyPayment,
        installmentCount,
        installments,
        totalPaid: 0,
        remainingAmount: totalWithInterest,
        cost: totalCost,
        profit: profit,
        createdDate: new Date().toISOString(),
        status: 'active',
        cashier: document.getElementById('currentUser').textContent.replace('ğŸ‘¤ ', '') || 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
    };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§
    installmentSales.push(installmentSale);
    products = updatedProducts;
    
    localStorage.setItem('installmentSales', JSON.stringify(installmentSales));
    localStorage.setItem('products', JSON.stringify(products));
    localStorage.setItem('customers', JSON.stringify(customers));

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ø±Ø¨Ø© ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„
    clearCart();
    clearSelectedCustomer();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadProductsForPOS();
    updateDashboard();
    closeModal('installmentModal');

    showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
    printInstallmentContract(installmentSale);
}

// Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù‚Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function printInstallmentContract(installmentSale) {
    const contractWindow = window.open('', '_blank');
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const storeName = settings.storeName || 'Ù…ØªØ¬Ø±ÙŠ';
    const storeAddress = settings.storeAddress || '';
    const storePhone = settings.storePhone || '';
    
    const contractHTML = `
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>Ø¹Ù‚Ø¯ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</title>
            <style>
                body { 
                    font-family: Arial, sans-serif; 
                    margin: 20px; 
                    line-height: 1.6; 
                }
                .header { 
                    text-align: center; 
                    border-bottom: 2px solid #000; 
                    padding-bottom: 20px; 
                }
                .content { 
                    margin: 20px 0; 
                }
                .signature { 
                    margin-top: 50px; 
                    display: flex; 
                    justify-content: space-between; 
                }
                table { 
                    width: 100%; 
                    border-collapse: collapse; 
                    margin: 20px 0; 
                }
                th, td { 
                    border: 1px solid #000; 
                    padding: 10px; 
                    text-align: center; 
                }
                th { 
                    background: #f0f0f0; 
                }
                .print-button { 
                    display: block; 
                    margin: 20px auto; 
                    padding: 10px; 
                    background: #4CAF50; 
                    color: white; 
                    border: none; 
                    border-radius: 5px; 
                    cursor: pointer; 
                }
                @media print {
                    .print-button { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>Ø¹Ù‚Ø¯ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</h1>
                <h2>${storeName}</h2>
                ${storeAddress ? `<p>${storeAddress}</p>` : ''}
                ${storePhone ? `<p>Ù‡Ø§ØªÙ: ${storePhone}</p>` : ''}
                <p>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯: ${installmentSale.invoiceNumber || installmentSale.id}</p>
                <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(installmentSale.createdDate).toLocaleDateString('ar-IQ')}</p>
            </div>
            
            <div class="content">
                <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:</h3>
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${installmentSale.customerName}</p>
                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${installmentSale.customerPhone}</p>
                
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹:</h3>
                <table>
                    <thead>
                        <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th></tr>
                    </thead>
                    <tbody>
                        ${installmentSale.items.map(item => `
                            <tr>
                                <td>${item.name}</td>
                                <td>${item.quantity}</td>
                                <td>${formatCurrency(item.price)}</td>
                                <td>${formatCurrency(item.price * item.quantity * (1 - item.discount / 100))}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ:</strong> ${formatCurrency(installmentSale.originalAmount)}</p>
                <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø©:</strong> ${installmentSale.interestRate}%</p>
                <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${formatCurrency(installmentSale.totalWithInterest)}</p>
                <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</strong> ${installmentSale.installmentCount} Ù‚Ø³Ø·</p>
                <p><strong>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</strong> ${formatCurrency(installmentSale.monthlyPayment)}</p>
                
                <h3>Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</h3>
                <table>
                    <thead>
                        <tr><th>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø·</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr>
                    </thead>
                    <tbody>
                        ${installmentSale.installments.map(inst => `
                            <tr>
                                <td>${inst.number}</td>
                                <td>${new Date(inst.dueDate).toLocaleDateString('ar-IQ')}</td>
                                <td>${formatCurrency(inst.amount)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            
            <div class="signature">
                <div>
                    <p>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
                    <p>_________________</p>
                </div>
                <div>
                    <p>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ØªØ¬Ø±</p>
                    <p>_________________</p>
                </div>
            </div>
            <button class="print-button" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¹Ù‚Ø¯</button>
        </body>
        </html>
    `;
    
    contractWindow.document.write(contractHTML);
    contractWindow.document.close();
}

// Ø­ÙØ¸ ÙƒØ¹Ø±Ø¶ Ø³Ø¹Ø±
function saveQuote() {
    if (cart.length === 0) {
        showNotification('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©', 'error');
        return;
    }

    const quote = {
        id: Date.now(),
        invoiceNumber: generateInvoiceNumber('Q'),
        customerId: selectedCustomer?.id || null,
        customerName: selectedCustomer?.fullName || 'Ø¹Ù…ÙŠÙ„ Ù…Ø¬Ù‡ÙˆÙ„',
        items: JSON.parse(JSON.stringify(cart)),
        subtotal: getSubtotal(),
        discount: getTotalDiscount(),
        tax: getTaxAmount(),
        total: getTotalAmount(),
        status: 'pending',
        validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), // ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…
        createdAt: new Date().toISOString(),
        cashier: document.getElementById('currentUser').textContent.replace('ğŸ‘¤ ', '') || 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
    };

    const quotes = JSON.parse(localStorage.getItem('quotes')) || [];
    quotes.push(quote);
    localStorage.setItem('quotes', JSON.stringify(quotes));

    showNotification('ØªÙ… Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
    printQuote(quote);
}

// Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±
function printQuote(quote) {
    const quoteWindow = window.open('', '_blank');
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const storeName = settings.storeName || 'Ù…ØªØ¬Ø±ÙŠ';
    const storeAddress = settings.storeAddress || '';
    const storePhone = settings.storePhone || '';
    
    const validUntil = new Date(quote.validUntil).toLocaleDateString('ar-IQ');
    
    const quoteHTML = `
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>Ø¹Ø±Ø¶ Ø³Ø¹Ø±</title>
            <style>
                body { 
                    font-family: Arial, sans-serif; 
                    margin: 20px; 
                    line-height: 1.6; 
                }
                .header { 
                    text-align: center; 
                    border-bottom: 2px solid #000; 
                    padding-bottom: 20px; 
                }
                .content { 
                    margin: 20px 0; 
                }
                .quote-info { 
                    display: flex; 
                    justify-content: space-between; 
                    margin-bottom: 20px; 
                }
                table { 
                    width: 100%; 
                    border-collapse: collapse; 
                    margin: 20px 0; 
                }
                th, td { 
                    border: 1px solid #000; 
                    padding: 10px; 
                    text-align: center; 
                }
                th { 
                    background: #f0f0f0; 
                }
                .total { 
                    text-align: left; 
                    margin-top: 20px; 
                }
                .note { 
                    margin-top: 30px; 
                    font-style: italic; 
                }
                .print-button { 
                    display: block; 
                    margin: 20px auto; 
                    padding: 10px; 
                    background: #4CAF50; 
                    color: white; 
                    border: none; 
                    border-radius: 5px; 
                    cursor: pointer; 
                }
                @media print {
                    .print-button { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>Ø¹Ø±Ø¶ Ø³Ø¹Ø±</h1>
                <h2>${storeName}</h2>
                ${storeAddress ? `<p>${storeAddress}</p>` : ''}
                ${storePhone ? `<p>Ù‡Ø§ØªÙ: ${storePhone}</p>` : ''}
            </div>
            
            <div class="content">
                <div class="quote-info">
                    <div>
                        <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${quote.customerName}</p>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¶:</strong> ${new Date(quote.createdAt).toLocaleDateString('ar-IQ')}</p>
                    </div>
                    <div>
                        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶:</strong> ${quote.invoiceNumber || quote.id}</p>
                        <p><strong>ØµØ§Ù„Ø­ Ù„ØºØ§ÙŠØ©:</strong> ${validUntil}</p>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø®ØµÙ…</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${quote.items.map((item, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${item.name}</td>
                                <td>${formatCurrency(item.price)}</td>
                                <td>${item.quantity}</td>
                                <td>${item.discount}%</td>
                                <td>${formatCurrency(item.price * item.quantity * (1 - item.discount / 100))}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div class="total">
                    <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</strong> ${formatCurrency(quote.subtotal)}</p>
                    ${quote.discount > 0 ? `<p><strong>Ø§Ù„Ø®ØµÙ…:</strong> ${formatCurrency(quote.discount)}</p>` : ''}
                    ${quote.tax > 0 ? `<p><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</strong> ${formatCurrency(quote.tax)}</p>` : ''}
                    <p style="font-size: 1.2em;"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</strong> ${formatCurrency(quote.total)}</p>
                </div>
                
                <div class="note">
                    <p>Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ… Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±.</p>
                    <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: ${storePhone || '_________'}</p>
                </div>
            </div>
            <button class="print-button" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</button>
        </body>
        </html>
    `;
    
    quoteWindow.document.write(quoteHTML);
    quoteWindow.document.close();
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
function addProduct() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©
    const name = document.getElementById('productName').value.trim();
    const mainCategory = document.getElementById('mainCategory').value;
    const costPrice = parseFloat(document.getElementById('costPrice').value) || 0;
    const salePrice = parseFloat(document.getElementById('salePrice').value) || 0;
    const productStock = parseInt(document.getElementById('productStock').value) || 0;
    
    if (!name || !mainCategory || salePrice <= 0) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
    const barcode = document.getElementById('productBarcode').value.trim() || generateBarcode();
    const subCategory = document.getElementById('subCategory').value;
    const minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
    const minStock = parseInt(document.getElementById('minStock').value) || 5;
    
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©
    const brand = document.getElementById('productBrand').value.trim();
    const model = document.getElementById('productModel').value.trim();
    const supplierId = document.getElementById('supplierId').value;
    const expiryDate = document.getElementById('expiryDate').value;
    const description = document.getElementById('productDescription').value.trim();
    const notes = document.getElementById('productNotes').value.trim();
    
    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ù†ØªØ¬
    const product = {
        id: Date.now(),
        name,
        barcode,
        mainCategory,
        subCategory,
        brand,
        model,
        costPrice,
        salePrice,
        minPrice,
        productStock,
        minStock,
        supplierId,
        expiryDate,
        description,
        notes,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ­ÙØ¸Ù‡
    products.push(product);
    saveProducts();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadProductsTable();
    loadProductsForPOS();
    clearProductForm();
    updateDashboard();
    
    // Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    showProductTab('product-list');
    
    showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function loadProductsTable() {
    const tbody = document.getElementById('productsTableBody');
    tbody.innerHTML = '';
    
    if (products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</td></tr>';
        return;
    }
    
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±
    const filteredProducts = filterProductsList();
    
    if (filteredProducts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«.</td></tr>';
        return;
    }
    
    filteredProducts.forEach(product => {
        const row = tbody.insertRow();
        
        // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        let stockStatus, stockClass;
        if (product.productStock <= 0) {
            stockStatus = 'Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†';
            stockClass = 'status-out-of-stock';
        } else if (product.productStock <= (product.minStock || 5)) {
            stockStatus = 'Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶';
            stockClass = 'status-low-stock';
        } else {
            stockStatus = 'Ù…ØªÙˆÙØ±';
            stockClass = 'status-active';
        }
        
        row.innerHTML = `
            <td><input type="checkbox" class="product-checkbox" value="${product.id}"></td>
            <td>${product.name}</td>
            <td>${product.barcode || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td>${getCategoryName(product.mainCategory)}</td>
            <td class="currency">${formatCurrency(product.costPrice || 0)}</td>
            <td class="currency">${formatCurrency(product.salePrice)}</td>
            <td>${product.productStock}</td>
            <td><span class="status-badge ${stockClass}">${stockStatus}</span></td>
            <td>
                <button class="btn btn-warning btn-sm" onclick="editProduct(${product.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                <button class="btn btn-info btn-sm" onclick="duplicateProduct(${product.id})" title="Ù†Ø³Ø®">ğŸ“‹</button>
                <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            </td>
        `;
    });
}

// ÙÙ„ØªØ±Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function filterProductsList() {
    const searchTerm = document.getElementById('productFilterInput')?.value?.toLowerCase() || '';
    const categoryFilter = document.getElementById('categoryFilterProducts')?.value || '';
    const statusFilter = document.getElementById('statusFilterProducts')?.value || '';
    
    return products.filter(product => {
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
        const nameMatch = product.name.toLowerCase().includes(searchTerm);
        const barcodeMatch = product.barcode && product.barcode.toLowerCase().includes(searchTerm);
        const searchMatch = nameMatch || barcodeMatch;
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
        const categoryMatch = !categoryFilter || product.mainCategory === categoryFilter;
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
        let statusMatch = true;
        if (statusFilter) {
            if (statusFilter === 'active') statusMatch = product.productStock > (product.minStock || 5);
            else if (statusFilter === 'inactive') statusMatch = product.productStock <= 0;
            else if (statusFilter === 'low-stock') statusMatch = product.productStock > 0 && product.productStock <= (product.minStock || 5);
        }
        
        return searchMatch && categoryMatch && statusMatch;
    });
}

// ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬
function editProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) {
        showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    currentEditProductId = productId;
    
    const modal = document.getElementById('editProductModal');
    const content = document.getElementById('editProductContent');
    
    content.innerHTML = `
        <div class="grid">
            <div class="form-group">
                <label class="required-field">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                <input type="text" id="editProductName" value="${product.name}" required>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
                <input type="text" id="editProductBarcode" value="${product.barcode || ''}">
            </div>
            <div class="form-group">
                <label class="required-field">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
                <select id="editMainCategory" onchange="updateEditSubCategories()" required>
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label>
                <select id="editSubCategory">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>
                </select>
            </div>
            <div class="form-group">
                <label class="required-field">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</label>
                <input type="number" id="editCostPrice" value="${product.costPrice || 0}" oninput="calculateEditProfitMargin()" required>
            </div>
            <div class="form-group">
                <label class="required-field">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
                <input type="number" id="editSalePrice" value="${product.salePrice}" oninput="calculateEditProfitMargin()" required>
            </div>
            <div class="form-group">
                <label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)</label>
                <input type="number" id="editProfitMargin" readonly>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø¹Ø±</label>
                <input type="number" id="editMinPrice" value="${product.minPrice || 0}">
            </div>
            <div class="form-group">
                <label class="required-field">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                <input type="number" id="editProductStock" value="${product.productStock}" required>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                <input type="number" id="editMinStock" value="${product.minStock || 5}">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</label>
                <input type="text" id="editProductBrand" value="${product.brand || ''}">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
                <input type="text" id="editProductModel" value="${product.model || ''}">
            </div>
        </div>
        <div class="form-group">
            <label>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
            <textarea id="editProductDescription" rows="3">${product.description || ''}</textarea>
        </div>
        <div class="form-group">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea id="editProductNotes" rows="2">${product.notes || ''}</textarea>
        </div>
        <div class="form-actions" style="margin-top: 20px;">
            <button class="btn btn-primary" onclick="updateProduct()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            <button class="btn btn-danger" onclick="closeModal('editProductModal')">âŒ Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    `;
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
    const editMainCategory = document.getElementById('editMainCategory');
    Object.keys(categoryStructure).forEach(key => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = categoryStructure[key].name;
        option.selected = key === product.mainCategory;
        editMainCategory.appendChild(option);
    });
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
    updateEditSubCategories(product.subCategory);
    
    // Ø­Ø³Ø§Ø¨ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­
    calculateEditProfitMargin();
    
    modal.style.display = 'block';
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function updateEditSubCategories(selectedSubCategory = null) {
    const mainCategory = document.getElementById('editMainCategory').value;
    const subCategorySelect = document.getElementById('editSubCategory');
    
    subCategorySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>';
    
    if (mainCategory && categoryStructure[mainCategory]) {
        categoryStructure[mainCategory].subcategories.forEach(sub => {
            const option = document.createElement('option');
            option.value = sub;
            option.textContent = sub;
            option.selected = sub === selectedSubCategory;
            subCategorySelect.appendChild(option);
        });
    }
}

// Ø­Ø³Ø§Ø¨ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function calculateEditProfitMargin() {
    const costPrice = parseFloat(document.getElementById('editCostPrice').value) || 0;
    const salePrice = parseFloat(document.getElementById('editSalePrice').value) || 0;
    
    if (costPrice > 0) {
        const margin = ((salePrice - costPrice) / costPrice) * 100;
        document.getElementById('editProfitMargin').value = margin.toFixed(2);
    } else {
        document.getElementById('editProfitMargin').value = '0';
    }
}

// ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬
function updateProduct() {
    if (!currentEditProductId) {
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬', 'error');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©
    const name = document.getElementById('editProductName').value.trim();
    const mainCategory = document.getElementById('editMainCategory').value;
    const costPrice = parseFloat(document.getElementById('editCostPrice').value) || 0;
    const salePrice = parseFloat(document.getElementById('editSalePrice').value) || 0;
    const productStock = parseInt(document.getElementById('editProductStock').value) || 0;
    
    if (!name || !mainCategory || salePrice <= 0) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }
    
    // Ø¬Ù…Ø¹ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const barcode = document.getElementById('editProductBarcode').value.trim();
    const subCategory = document.getElementById('editSubCategory').value;
    const minPrice = parseFloat(document.getElementById('editMinPrice').value) || 0;
    const minStock = parseInt(document.getElementById('editMinStock').value) || 5;
    const brand = document.getElementById('editProductBrand').value.trim();
    const model = document.getElementById('editProductModel').value.trim();
    const description = document.getElementById('editProductDescription').value.trim();
    const notes = document.getElementById('editProductNotes').value.trim();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬
    const productIndex = products.findIndex(p => p.id === currentEditProductId);
    if (productIndex === -1) {
        showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§
    const originalProduct = products[productIndex];
    products[productIndex] = {
        ...originalProduct,
        name,
        barcode,
        mainCategory,
        subCategory,
        brand,
        model,
        costPrice,
        salePrice,
        minPrice,
        productStock,
        minStock,
        description,
        notes,
        updatedAt: new Date().toISOString()
    };
    
    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    saveProducts();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadProductsTable();
    loadProductsForPOS();
    updateDashboard();
    
    closeModal('editProductModal');
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// Ø­Ø°Ù Ù…Ù†ØªØ¬
function deleteProduct(productId) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
        return;
    }
    
    const productIndex = products.findIndex(p => p.id === productId);
    if (productIndex === -1) {
        showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
    const productName = products[productIndex].name;
    products.splice(productIndex, 1);
    
    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    saveProducts();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadProductsTable();
    loadProductsForPOS();
    updateDashboard();
    
    showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${productName}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
}

// Ù†Ø³Ø® Ù…Ù†ØªØ¬
function duplicateProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) {
        showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    const newProduct = {
        ...product,
        id: Date.now(),
        name: `${product.name} (Ù†Ø³Ø®Ø©)`,
        barcode: generateBarcode(),
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
    
    products.push(newProduct);
    saveProducts();
    
    loadProductsTable();
    loadProductsForPOS();
    updateDashboard();
    
    showNotification(`ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ù†ØªØ¬ "${product.name}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
}

// Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
function addCustomer() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©
    const fullName = document.getElementById('customerFullName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    
    if (!fullName || !phone) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const email = document.getElementById('customerEmail').value.trim();
    const type = document.getElementById('customerType').value;
    const address = document.getElementById('customerAddress').value.trim();
    const notes = document.getElementById('customerNotes').value.trim();
    
    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„
    const customer = {
        id: Date.now(),
        fullName,
        phone,
        email,
        type,
        address,
        notes,
        loyaltyPoints: 0,
        totalPurchases: 0,
        lastVisit: null,
        createdAt: new Date().toISOString()
    };
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ­ÙØ¸Ù‡
    customers.push(customer);
    saveCustomers();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadCustomersTable();
    clearCustomerForm();
    updateDashboard();
    
    // Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    showCustomerTab('customer-list');
    
    showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
function loadCustomersTable() {
    const tbody = document.getElementById('customersTableBody');
    tbody.innerHTML = '';
    
    if (customers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="centered-content">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯.</td></tr>';
        return;
    }
    
    customers.forEach(customer => {
        const row = tbody.insertRow();
        const lastVisit = customer.lastVisit ? 
            new Date(customer.lastVisit).toLocaleDateString('ar-IQ') : 'Ù„Ù… ÙŠØ²Ø± Ø¨Ø¹Ø¯';
        
        const customerType = customer.type === 'vip' ? 'Ù…Ù…ÙŠØ²' : 
                           customer.type === 'wholesale' ? 'ØªØ§Ø¬Ø± Ø¬Ù…Ù„Ø©' : 'Ø¹Ø§Ø¯ÙŠ';
        
        const typeClass = customer.type === 'vip' ? 'badge-warning' : 
                         customer.type === 'wholesale' ? 'badge-info' : 'badge-primary';

        row.innerHTML = `
            <td>${customer.fullName}</td>
            <td>${customer.phone}</td>
            <td>${customer.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td><span class="badge ${typeClass}">${customerType}</span></td>
            <td>${customer.loyaltyPoints || 0}</td>
            <td class="currency">${formatCurrency(customer.totalPurchases || 0)}</td>
            <td>${lastVisit}</td>
            <td>
                <button class="btn btn-warning btn-sm" onclick="editCustomer(${customer.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                <button class="btn btn-info btn-sm" onclick="viewCustomerHistory(${customer.id})" title="Ø§Ù„Ø³Ø¬Ù„">ğŸ“Š</button>
                <button class="btn btn-danger btn-sm" onclick="deleteCustomer(${customer.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            </td>
        `;
    });
}

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
function searchCustomers() {
    const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
    const rows = document.querySelectorAll('#customersTableBody tr');
    
    rows.forEach(row => {
        if (row.cells.length < 2) return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø±Ø³Ø§Ø¦Ù„ "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡"
        
        const customerName = row.cells[0].textContent.toLowerCase();
        const customerPhone = row.cells[1].textContent.toLowerCase();
        const isVisible = customerName.includes(searchTerm) || customerPhone.includes(searchTerm);
        row.style.display = isVisible ? 'table-row' : 'none';
    });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…ÙŠÙ„
function editCustomer(customerId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„
function viewCustomerHistory(customerId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø­Ø°Ù Ø¹Ù…ÙŠÙ„
function deleteCustomer(customerId) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) {
        return;
    }
    
    const customerIndex = customers.findIndex(c => c.id === customerId);
    if (customerIndex === -1) {
        showNotification('Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„
    const hasRelatedSales = sales.some(sale => sale.customerId === customerId);
    const hasRelatedInstallments = installmentSales.some(sale => sale.customerId === customerId);
    
    if (hasRelatedSales || hasRelatedInstallments) {
        if (!confirm('Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø¯ÙŠÙ‡ Ù…Ø¨ÙŠØ¹Ø§Øª Ø£Ùˆ Ø£Ù‚Ø³Ø§Ø· Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ø°ÙØŸ')) {
            return;
        }
    }
    
    // Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„
    const customerName = customers[customerIndex].fullName;
    customers.splice(customerIndex, 1);
    
    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    saveCustomers();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadCustomersTable();
    updateDashboard();
    
    showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ "${customerName}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
}

// Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯
function addSupplier() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©
    const company = document.getElementById('supplierCompany').value.trim();
    const phone = document.getElementById('supplierPhone').value.trim();
    
    if (!company || !phone) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const contact = document.getElementById('supplierContact').value.trim();
    const email = document.getElementById('supplierEmail').value.trim();
    const address = document.getElementById('supplierAddress').value.trim();
    const notes = document.getElementById('supplierNotes').value.trim();
    
    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…ÙˆØ±Ø¯
    const supplier = {
        id: Date.now(),
        company,
        contact,
        phone,
        email,
        address,
        notes,
        rating: 3, // ØªÙ‚ÙŠÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠ
        totalOrders: 0,
        lastOrder: null,
        createdAt: new Date().toISOString()
    };
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ±Ø¯ ÙˆØ­ÙØ¸Ù‡
    suppliers.push(supplier);
    saveSuppliers();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadSuppliersTable();
    clearSupplierForm();
    
    // Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
    showSupplierTab('supplier-list');
    
    showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
function loadSuppliersTable() {
    const tbody = document.getElementById('suppliersTableBody');
    tbody.innerHTML = '';
    
    if (suppliers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="centered-content">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ±Ø¯ÙŠÙ†. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ÙŠÙ† Ø¬Ø¯Ø¯.</td></tr>';
        return;
    }
    
    suppliers.forEach(supplier => {
        const row = tbody.insertRow();
        const stars = 'â­'.repeat(supplier.rating || 3);
        const lastOrder = supplier.lastOrder ? 
            new Date(supplier.lastOrder).toLocaleDateString('ar-IQ') : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨ÙŠØ§Øª';

        row.innerHTML = `
            <td>${supplier.company}</td>
            <td>${supplier.contact || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td>${supplier.phone}</td>
            <td>${supplier.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td>${stars}</td>
            <td>${lastOrder}</td>
            <td>
                <button class="btn btn-warning btn-sm" onclick="editSupplier(${supplier.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                <button class="btn btn-info btn-sm" onclick="createPurchaseOrder(${supplier.id})" title="Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©">ğŸ“‹</button>
                <button class="btn btn-danger btn-sm" onclick="deleteSupplier(${supplier.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            </td>
        `;
    });
}

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
function searchSuppliers() {
    const searchTerm = document.getElementById('supplierSearch').value.toLowerCase();
    const rows = document.querySelectorAll('#suppliersTableBody tr');
    
    rows.forEach(row => {
        if (row.cells.length < 3) return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø±Ø³Ø§Ø¦Ù„ "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ±Ø¯ÙŠÙ†"
        
        const companyName = row.cells[0].textContent.toLowerCase();
        const contactName = row.cells[1].textContent.toLowerCase();
        const phone = row.cells[2].textContent.toLowerCase();
        const isVisible = companyName.includes(searchTerm) || contactName.includes(searchTerm) || phone.includes(searchTerm);
        row.style.display = isVisible ? 'table-row' : 'none';
    });
}

// ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ±Ø¯
function editSupplier(supplierId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
function createPurchaseOrder(supplierId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø­Ø°Ù Ù…ÙˆØ±Ø¯
function deleteSupplier(supplierId) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯ØŸ')) {
        return;
    }
    
    const supplierIndex = suppliers.findIndex(s => s.id === supplierId);
    if (supplierIndex === -1) {
        showNotification('Ø§Ù„Ù…ÙˆØ±Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    // Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ±Ø¯
    const supplierName = suppliers[supplierIndex].company;
    suppliers.splice(supplierIndex, 1);
    
    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    saveSuppliers();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadSuppliersTable();
    
    showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ±Ø¯ "${supplierName}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
function loadSalesTable() {
    const tbody = document.getElementById('salesTableBody');
    tbody.innerHTML = '';
    
    if (sales.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø¹Ø¯.</td></tr>';
        return;
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
    const sortedSales = [...sales].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedSales.forEach(sale => {
        const row = tbody.insertRow();
        const saleDate = new Date(sale.date).toLocaleDateString('ar-IQ');
        const itemsCount = sale.items.reduce((sum, item) => sum + item.quantity, 0);
        
        row.innerHTML = `
            <td>${sale.invoiceNumber || sale.id}</td>
            <td>${saleDate}</td>
            <td>${sale.customerName}</td>
            <td>${itemsCount}</td>
            <td class="currency">${formatCurrency(sale.total)}</td>
            <td>${sale.type === 'cash' ? 'Ù†Ù‚Ø¯ÙŠ' : 'Ø£Ù‚Ø³Ø§Ø·'}</td>
            <td>${sale.cashier}</td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewSaleDetails(${sale.id})" title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">ğŸ‘ï¸</button>
                <button class="btn btn-success btn-sm" onclick="printSaleReceipt(${sale.id})" title="Ø·Ø¨Ø§Ø¹Ø©">ğŸ–¨ï¸</button>
                <button class="btn btn-danger btn-sm" onclick="returnSale(${sale.id})" title="Ù…Ø±ØªØ¬Ø¹">â†©ï¸</button>
            </td>
        `;
    });
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
function filterSales() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹
function viewSaleDetails(saleId) {
    const sale = sales.find(s => s.id === saleId);
    if (!sale) {
        showNotification('Ø§Ù„Ø¨ÙŠØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    const modal = document.getElementById('invoiceDetailsModal');
    const content = document.getElementById('invoiceContent');
    
    content.innerHTML = `
        <div class="card">
            <div class="card-header">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
            </div>
            <div>
                <p><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> ${sale.invoiceNumber || sale.id}</p>
                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(sale.date).toLocaleDateString('ar-IQ')}</p>
                <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${sale.customerName}</p>
                <p><strong>Ø§Ù„ÙƒØ§Ø´ÙŠØ±:</strong> ${sale.cashier}</p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹:</strong> ${sale.type === 'cash' ? 'Ù†Ù‚Ø¯ÙŠ' : 'Ø£Ù‚Ø³Ø§Ø·'}</p>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„Ø®ØµÙ…</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sale.items.map(item => `
                            <tr>
                                <td>${item.name}</td>
                                <td>${item.quantity}</td>
                                <td class="currency">${formatCurrency(item.price)}</td>
                                <td>${item.discount || 0}%</td>
                                <td class="currency">${formatCurrency(item.price * item.quantity * (1 - (item.discount || 0) / 100))}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>Ø§Ù„Ø¯ÙØ¹</h3>
            </div>
            <div class="cart-summary">
                <div class="cart-row">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                    <span class="currency">${formatCurrency(sale.subtotal)}</span>
                </div>
                ${sale.discount > 0 ? `
                    <div class="cart-row">
                        <span>Ø§Ù„Ø®ØµÙ…:</span>
                        <span class="currency">${formatCurrency(sale.discount)}</span>
                    </div>
                ` : ''}
                ${sale.tax > 0 ? `
                    <div class="cart-row">
                        <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                        <span class="currency">${formatCurrency(sale.tax)}</span>
                    </div>
                ` : ''}
                <div class="cart-total">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                    <span class="currency">${formatCurrency(sale.total)}</span>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 20px;">
            <button class="btn btn-success" onclick="printSaleReceipt(${sale.id})">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
            <button class="btn btn-danger" onclick="closeModal('invoiceDetailsModal')">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    `;
    
    modal.style.display = 'block';
}

// Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹
function printSaleReceipt(saleId) {
    const sale = sales.find(s => s.id === saleId);
    if (!sale) {
        showNotification('Ø§Ù„Ø¨ÙŠØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
    }
    
    printReceipt(sale);
}

// Ø¥Ø±Ø¬Ø§Ø¹ Ø¨ÙŠØ¹
function returnSale(saleId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function loadInstallmentsTable() {
    const tbody = document.getElementById('installmentsTableBody');
    tbody.innerHTML = '';
    
    if (installmentSales.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠÙˆØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø¹Ø¯.</td></tr>';
        return;
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
    const sortedInstallments = [...installmentSales].sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
    
    sortedInstallments.forEach(sale => {
        const row = tbody.insertRow();
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
        const totalPaid = sale.totalPaid || 0;
        const remainingAmount = sale.totalWithInterest - totalPaid;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        let statusText, statusClass;
        if (sale.status === 'completed') {
            statusText = 'Ù…ÙƒØªÙ…Ù„';
            statusClass = 'status-completed';
        } else if (sale.status === 'cancelled') {
            statusText = 'Ù…Ù„ØºÙŠ';
            statusClass = 'status-cancelled';
        } else {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ£Ø®Ø±Ø©
            const hasOverdueInstallments = sale.installments.some(inst => 
                !inst.paid && new Date(inst.dueDate) < new Date()
            );
            
            if (hasOverdueInstallments) {
                statusText = 'Ù…ØªØ£Ø®Ø±';
                statusClass = 'status-cancelled';
            } else {
                statusText = 'Ù†Ø´Ø·';
                statusClass = 'status-active';
            }
        }
        
        row.innerHTML = `
            <td>${sale.invoiceNumber || sale.id}</td>
            <td>${sale.customerName}</td>
            <td class="currency">${formatCurrency(sale.totalWithInterest)}</td>
            <td class="currency">${formatCurrency(totalPaid)}</td>
            <td class="currency">${formatCurrency(remainingAmount)}</td>
            <td>${sale.installmentCount}</td>
            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewInstallmentDetails(${sale.id})" title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">ğŸ‘ï¸</button>
                <button class="btn btn-success btn-sm" onclick="addInstallmentPayment(${sale.id})" title="Ø¯ÙØ¹ Ù‚Ø³Ø·">ğŸ’°</button>
                <button class="btn btn-warning btn-sm" onclick="printInstallmentContract(${JSON.stringify(sale).replace(/"/g, '&quot;')});" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¹Ù‚Ø¯">ğŸ–¨ï¸</button>
            </td>
        `;
    });
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function filterInstallments() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function viewInstallmentDetails(saleId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© Ù‚Ø³Ø·
function addInstallmentPayment(saleId) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª
function loadReturnsTable() {
    const tbody = document.getElementById('returnsTableBody');
    tbody.innerHTML = '';
    
    if (returns.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ØªØ¬Ø¹Ø§Øª Ø¨Ø¹Ø¯.</td></tr>';
        return;
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
    const sortedReturns = [...returns].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedReturns.forEach(returnItem => {
        const row = tbody.insertRow();
        const returnDate = new Date(returnItem.date).toLocaleDateString('ar-IQ');
        
        row.innerHTML = `
            <td>${returnItem.id}</td>
            <td>${returnItem.saleInvoiceNumber || returnItem.saleId}</td>
            <td>${returnDate}</td>
            <td>${returnItem.customerName}</td>
            <td>${returnItem.items.length}</td>
            <td class="currency">${formatCurrency(returnItem.totalAmount)}</td>
            <td>${returnItem.reason || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewReturnDetails(${returnItem.id})" title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">ğŸ‘ï¸</button>
                <button class="btn btn-success btn-sm" onclick="printReturnReceipt(${returnItem.id})" title="Ø·Ø¨Ø§Ø¹Ø©">ğŸ–¨ï¸</button>
            </td>
        `;
    });
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø±ØªØ¬Ø¹ Ø¬Ø¯ÙŠØ¯
function showNewReturnModal() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
function loadExpensesTable() {
    const tbody = document.getElementById('expensesTableBody');
    tbody.innerHTML = '';
    
    if (expenses.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="centered-content">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ø¹Ø¯.</td></tr>';
        return;
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
    const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedExpenses.forEach(expense => {
        const row = tbody.insertRow();
        const expenseDate = new Date(expense.date).toLocaleDateString('ar-IQ');
        
        row.innerHTML = `
            <td>${expenseDate}</td>
            <td>${expense.description}</td>
            <td>${expense.category}</td>
            <td class="currency">${formatCurrency(expense.amount)}</td>
            <td>${expense.notes || '-'}</td>
            <td>
                <button class="btn btn-warning btn-sm" onclick="editExpense(${expense.id})" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                <button class="btn btn-danger btn-sm" onclick="deleteExpense(${expense.id})" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            </td>
        `;
    });
}

// Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
function showNewExpenseModal() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
function generateSalesReport() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

function generateInventoryReport() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

function generateProfitReport() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

function generateCustomerReport() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„
function openCustomerModal() {
    document.getElementById('customerModal').style.display = 'block';
    loadCustomersList();
}

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
function loadCustomersList() {
    const customersList = document.getElementById('customersList');
    customersList.innerHTML = '';
    
    if (customers.length === 0) {
        customersList.innerHTML = '<div class="centered-content"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯.</p></div>';
        return;
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø´Ø¨ÙƒØ© Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    const customerGrid = document.createElement('div');
    customerGrid.className = 'product-grid';
    
    customers.forEach(customer => {
        const customerCard = document.createElement('div');
        customerCard.className = 'product-card';
        customerCard.onclick = () => selectCustomer(customer);
        
        const customerType = customer.type === 'vip' ? 'Ù…Ù…ÙŠØ²' : 
                           customer.type === 'wholesale' ? 'ØªØ§Ø¬Ø± Ø¬Ù…Ù„Ø©' : 'Ø¹Ø§Ø¯ÙŠ';
        
        const typeClass = customer.type === 'vip' ? 'badge-warning' : 
                         customer.type === 'wholesale' ? 'badge-info' : 'badge-primary';
        
        customerCard.innerHTML = `
            <div class="product-info">
                <h4>${customer.fullName}</h4>
                <p>ğŸ“ ${customer.phone}</p>
                <p><span class="badge ${typeClass}">${customerType}</span></p>
                <p>â­ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡: ${customer.loyaltyPoints || 0}</p>
            </div>
        `;
        
        customerGrid.appendChild(customerCard);
    });
    
    customersList.appendChild(customerGrid);
}

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
function searchCustomersModal() {
    const searchTerm = document.getElementById('customerModalSearch').value.toLowerCase();
    const customerCards = document.querySelectorAll('#customersList .product-card');
    
    customerCards.forEach(card => {
        const customerName = card.querySelector('h4').textContent.toLowerCase();
        const customerPhone = card.querySelector('p').textContent.toLowerCase();
        const isVisible = customerName.includes(searchTerm) || customerPhone.includes(searchTerm) || searchTerm === '';
        card.style.display = isVisible ? 'block' : 'none';
    });
}

// Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„
function selectCustomer(customer) {
    selectedCustomer = customer;
    document.getElementById('selectedCustomer').style.display = 'block';
    document.getElementById('customerName').textContent = customer.fullName;
    closeModal('customerModal');
    showNotification(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„: ${customer.fullName}`, 'success');
}

// Ù…Ø³Ø­ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯
function clearSelectedCustomer() {
    selectedCustomer = null;
    document.getElementById('selectedCustomer').style.display = 'none';
    showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„', 'info');
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©
function getCategoryName(categoryKey) {
    return categoryStructure[categoryKey]?.name || categoryKey || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
}

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†
function toggleAccordion(header) {
    header.classList.toggle('active');
    const content = header.nextElementSibling;
    
    if (content.style.display === 'block') {
        content.style.display = 'none';
    } else {
        content.style.display = 'block';
    }
}

// ØªØ¨Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
function toggleSelectAll() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.product-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

// Ø­Ø³Ø§Ø¨ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­
function calculateProfitMargin() {
    const costPrice = parseFloat(document.getElementById('costPrice').value) || 0;
    const salePrice = parseFloat(document.getElementById('salePrice').value) || 0;
    
    if (costPrice > 0) {
        const margin = ((salePrice - costPrice) / costPrice) * 100;
        document.getElementById('profitMargin').value = margin.toFixed(2);
    } else {
        document.getElementById('profitMargin').value = '0';
    }
}

// Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
function createBackup() {
    const backupData = {
        products,
        customers,
        suppliers,
        sales,
        installmentSales,
        returns,
        expenses,
        settings,
        timestamp: new Date().toISOString(),
        version: '2.0'
    };

    const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);

    showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}
// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
function restoreBackup(fileInput) {
    const file = fileInput.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const backupData = JSON.parse(e.target.result);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!backupData.products || !backupData.customers || !backupData.suppliers) {
                throw new Error('Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„.');
            }
            
            // Ø¹Ø±Ø¶ ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (!confirm('Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) {
                return;
            }
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            products = backupData.products || [];
            customers = backupData.customers || [];
            suppliers = backupData.suppliers || [];
            sales = backupData.sales || [];
            installmentSales = backupData.installmentSales || [];
            returns = backupData.returns || [];
            expenses = backupData.expenses || [];
            settings = backupData.settings || {};
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            saveProducts();
            saveCustomers();
            saveSuppliers();
            localStorage.setItem('sales', JSON.stringify(sales));
            localStorage.setItem('installmentSales', JSON.stringify(installmentSales));
            localStorage.setItem('returns', JSON.stringify(returns));
            localStorage.setItem('expenses', JSON.stringify(expenses));
            localStorage.setItem('settings', JSON.stringify(settings));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadAllData();
            applySettings();
            
            showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success');
        } catch (error) {
            showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
        }
    };
    
    reader.readAsText(file);
}

// Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function saveSettings() {
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    const storeName = document.getElementById('storeName')?.value;
    const storeAddress = document.getElementById('storeAddress')?.value;
    const storePhone = document.getElementById('storePhone')?.value;
    const storeEmail = document.getElementById('storeEmail')?.value;
    const currency = document.getElementById('currency')?.value;
    const language = document.getElementById('language')?.value;
    const dateFormat = document.getElementById('dateFormat')?.value;
    const defaultTaxRate = parseFloat(document.getElementById('defaultTaxRate')?.value) || 0;
    const defaultInterestRate = parseFloat(document.getElementById('defaultInterestRate')?.value) || 5;
    const defaultInstallments = parseInt(document.getElementById('defaultInstallments')?.value) || 12;
    const showProductImage = document.getElementById('showProductImage')?.value === '1';
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    settings = {
        ...settings,
        storeName,
        storeAddress,
        storePhone,
        storeEmail,
        currency,
        language,
        dateFormat,
        defaultTaxRate,
        defaultInterestRate,
        defaultInstallments,
        showProductImage
    };
    
    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    localStorage.setItem('settings', JSON.stringify(settings));
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    applySettings();
    
    showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function applySettings() {
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
    if (settings.storeName) {
        document.title = settings.storeName;
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (document.getElementById('storeName')) document.getElementById('storeName').value = settings.storeName || '';
    if (document.getElementById('storeAddress')) document.getElementById('storeAddress').value = settings.storeAddress || '';
    if (document.getElementById('storePhone')) document.getElementById('storePhone').value = settings.storePhone || '';
    if (document.getElementById('storeEmail')) document.getElementById('storeEmail').value = settings.storeEmail || '';
    if (document.getElementById('currency')) document.getElementById('currency').value = settings.currency || 'IQD';
    if (document.getElementById('language')) document.getElementById('language').value = settings.language || 'ar';
    if (document.getElementById('dateFormat')) document.getElementById('dateFormat').value = settings.dateFormat || 'DD/MM/YYYY';
    if (document.getElementById('defaultTaxRate')) document.getElementById('defaultTaxRate').value = settings.defaultTaxRate || 0;
    if (document.getElementById('defaultInterestRate')) document.getElementById('defaultInterestRate').value = settings.defaultInterestRate || 5;
    if (document.getElementById('defaultInstallments')) document.getElementById('defaultInstallments').value = settings.defaultInstallments || 12;
    if (document.getElementById('showProductImage')) document.getElementById('showProductImage').value = settings.showProductImage ? '1' : '0';
    
    // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if (document.getElementById('taxRate')) document.getElementById('taxRate').value = settings.defaultTaxRate || 0;
    
    // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    updateCartTotal();
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±
function showNotification(message, type = 'info') {
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => {
        notification.remove();
    });
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
    const notification = document.createElement('div');
    notification.className = 'notification';
    
    // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    switch (type) {
        case 'success':
            notification.style.background = '#27ae60';
            break;
        case 'error':
            notification.style.background = '#e74c3c';
            break;
        case 'warning':
            notification.style.background = '#f39c12';
            break;
        default:
            notification.style.background = '#3498db';
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ù…Ø² ØªØ¹Ø¨ÙŠØ±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    let icon = '';
    switch (type) {
        case 'success':
            icon = 'âœ… ';
            break;
        case 'error':
            icon = 'âŒ ';
            break;
        case 'warning':
            icon = 'âš ï¸ ';
            break;
        default:
            icon = 'â„¹ï¸ ';
    }
    
    notification.textContent = icon + message;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
    document.body.appendChild(notification);
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†Ù
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 4000);
}

// ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø©
function generateInvoiceNumber(prefix = 'INV') {
    const date = new Date();
    const year = date.getFullYear().toString().substr(2, 2);
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const random = Math.floor(Math.random() * 9000 + 1000);
    
    return `${prefix}${year}${month}${day}-${random}`;
}

// ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯
function generateBarcode() {
    return Date.now().toString() + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
}

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
function formatCurrency(amount) {
    const currency = settings.currency || 'IQD';
    let symbol;
    
    switch (currency) {
        case 'USD':
            symbol = '$';
            break;
        case 'EUR':
            symbol = 'â‚¬';
            break;
        case 'SAR':
            symbol = 'Ø±.Ø³';
            break;
        case 'AED':
            symbol = 'Ø¯.Ø¥';
            break;
        default:
            symbol = 'Ø¯.Ø¹';
    }
    
    return amount.toLocaleString() + ' ' + symbol;
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ
function getSubtotal() {
    return cart.reduce((sum, item) => sum + (item.price * item.quantity * (1 - item.discount / 100)), 0);
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…
function getTotalDiscount() {
    const subtotal = getSubtotal();
    const discountRate = parseFloat(document.getElementById('totalDiscount').value) || 0;
    return subtotal * (discountRate / 100);
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
function getTaxAmount() {
    const afterDiscount = getSubtotal() - getTotalDiscount();
    const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
    return afterDiscount * (taxRate / 100);
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº
function getTotalAmount() {
    const subtotal = getSubtotal();
    const discount = getTotalDiscount();
    const tax = getTaxAmount();
    return subtotal - discount + tax;
}

// Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function saveProducts() {
    localStorage.setItem('products', JSON.stringify(products));
}

// Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
function saveCustomers() {
    localStorage.setItem('customers', JSON.stringify(customers));
}

// Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
function saveSuppliers() {
    localStorage.setItem('suppliers', JSON.stringify(suppliers));
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
function loadCategories() {
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª ÙÙŠ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
    const categorySelects = [
        'categoryFilter', 
        'categoryFilterProducts',
        'mainCategory'
    ];
    
    categorySelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (!select) return;
        
        // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        while (select.options.length > 1) {
            select.remove(1);
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø§Øª
        Object.keys(categoryStructure).forEach(key => {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = categoryStructure[key].name;
            select.appendChild(option);
        });
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¥Ø°Ø§ ØªÙ… ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø±Ø¦ÙŠØ³ÙŠØ©
    updateSubCategories();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
function updateSubCategories() {
    const mainCategory = document.getElementById('mainCategory').value;
    const subCategorySelect = document.getElementById('subCategory');
    
    if (!subCategorySelect) return;
    
    // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    while (subCategorySelect.options.length > 1) {
        subCategorySelect.remove(1);
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¥Ø°Ø§ ØªÙ… ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø±Ø¦ÙŠØ³ÙŠØ©
    if (mainCategory && categoryStructure[mainCategory]) {
        categoryStructure[mainCategory].subcategories.forEach(sub => {
            const option = document.createElement('option');
            option.value = sub;
            option.textContent = sub;
            subCategorySelect.appendChild(option);
        });
    }
}

// Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†ØªØ¬
function clearProductForm() {
    const form = document.querySelector('#add-product');
    if (!form) return;
    
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (input.type === 'number') {
            input.value = '0';
        } else if (input.tagName === 'SELECT') {
            input.selectedIndex = 0;
        } else {
            input.value = '';
        }
    });
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    document.getElementById('minStock').value = '5';
}

// Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù…ÙŠÙ„
function clearCustomerForm() {
    const form = document.querySelector('#add-customer');
    if (!form) return;
    
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (input.tagName === 'SELECT') {
            input.selectedIndex = 0;
        } else {
            input.value = '';
        }
    });
}

// Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ±Ø¯
function clearSupplierForm() {
    const form = document.querySelector('#add-supplier');
    if (!form) return;
    
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (input.tagName === 'SELECT') {
            input.selectedIndex = 0;
        } else {
            input.value = '';
        }
    });
}

// ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function exportProducts() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª
    if (products.length === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
        return;
    }
    
    // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±
    const exportData = products.map(product => ({
        id: product.id,
        name: product.name,
        barcode: product.barcode,
        mainCategory: getCategoryName(product.mainCategory),
        subCategory: product.subCategory,
        costPrice: product.costPrice,
        salePrice: product.salePrice,
        stock: product.productStock,
        minStock: product.minStock,
        brand: product.brand,
        model: product.model,
        description: product.description,
        notes: product.notes
    }));
    
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ CSV
    let csv = 'Ø§Ù„Ù…Ø¹Ø±Ù,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯,Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©,Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©,Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡,Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹,Ø§Ù„Ù…Ø®Ø²ÙˆÙ†,Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†,Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©,Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„,Ø§Ù„ÙˆØµÙ,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
    
    exportData.forEach(product => {
        const row = [
            product.id,
            `"${product.name.replace(/"/g, '""')}"`, // ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØµÙ„ ÙÙŠ Ø§Ù„Ù†Øµ
            product.barcode,
            `"${product.mainCategory}"`,
            `"${product.subCategory || ''}"`,
            product.costPrice,
            product.salePrice,
            product.stock,
            product.minStock,
            `"${product.brand || ''}"`,
            `"${product.model || ''}"`,
            `"${(product.description || '').replace(/"/g, '""')}"`,
            `"${(product.notes || '').replace(/"/g, '""')}"`
        ];
        
        csv += row.join(',') + '\n';
    });
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù„Ù„ØªÙ†Ø²ÙŠÙ„
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `products_export_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    URL.revokeObjectURL(url);
    
    showNotification(`ØªÙ… ØªØµØ¯ÙŠØ± ${products.length} Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
}

// Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function showImportModal() {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§
    showNotification('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø±ÙŠØ¨Ù‹Ø§', 'info');
}

// Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†
    const accordionHeaders = document.querySelectorAll('.accordion-header');
    accordionHeaders.forEach(header => {
        header.addEventListener('click', function() {
            this.classList.toggle('active');
            const content = this.nextElementSibling;
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        });
    });
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
    document.querySelectorAll('#settings input, #settings select, #settings textarea').forEach(element => {
        element.addEventListener('change', function() {
            saveSettings();
        });
    });
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§
    window.addEventListener('click', function(event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…ÙØ§ØªÙŠØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
    document.addEventListener('keydown', function(event) {
        // Esc Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        if (event.key === 'Escape') {
            const openModals = document.querySelectorAll('.modal[style*="display: block"]');
            if (openModals.length > 0) {
                openModals.forEach(modal => {
                    modal.style.display = 'none';
                });
                event.preventDefault();
            }
        }
        
        // Ctrl+P Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
        if (event.ctrlKey && event.key === 'p') {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ¹ Ù†Ø´Ø·
            if (cart.length > 0) {
                event.preventDefault();
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØŸ')) {
                    processCashSale();
                }
            }
        }
        
        // F2 Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
        if (event.key === 'F2') {
            event.preventDefault();
            showTab('pos');
        }
        
        // F3 Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        if (event.key === 'F3') {
            event.preventDefault();
            document.getElementById('productSearch')?.focus();
        }
        
        // F4 Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
        if (event.key === 'F4') {
            event.preventDefault();
            showTab('products');
            showProductTab('add-product');
        }
    });
});

// Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± (ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
function loadDemoData() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„
    if (localStorage.getItem('demoDataLoaded')) {
        return;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    const demoProducts = [
        {
            id: 1001,
            name: 'Ù‡Ø§ØªÙ Ø°ÙƒÙŠ Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ Ø¬Ø§Ù„Ø§ÙƒØ³ÙŠ',
            barcode: '1001000001',
            mainCategory: 'electronics',
            subCategory: 'Ù‡ÙˆØ§ØªÙ Ø°ÙƒÙŠØ©',
            brand: 'Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬',
            model: 'Ø¬Ø§Ù„Ø§ÙƒØ³ÙŠ S21',
            costPrice: 400000,
            salePrice: 450000,
            productStock: 15,
            minStock: 3,
            description: 'Ù‡Ø§ØªÙ Ø°ÙƒÙŠ Ù…Ù† Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ Ø¨Ø´Ø§Ø´Ø© 6.2 Ø¨ÙˆØµØ© ÙˆØ°Ø§ÙƒØ±Ø© 128 Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1002,
            name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Ø¯ÙŠÙ„ Ø§Ù†Ø³Ø¨Ø§ÙŠØ±ÙˆÙ†',
            barcode: '1002000002',
            mainCategory: 'electronics',
            subCategory: 'Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ…Ø¨ÙŠÙˆØªØ±',
            brand: 'Ø¯ÙŠÙ„',
            model: 'Ø§Ù†Ø³Ø¨Ø§ÙŠØ±ÙˆÙ† 15',
            costPrice: 700000,
            salePrice: 800000,
            productStock: 8,
            minStock: 2,
            description: 'Ù„Ø§Ø¨ØªÙˆØ¨ Ø¨Ù…Ø¹Ø§Ù„Ø¬ ÙƒÙˆØ± i5 ÙˆØ°Ø§ÙƒØ±Ø© 8 Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª ÙˆÙ‡Ø§Ø±Ø¯ 512 Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª SSD',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1003,
            name: 'ØªÙ„ÙØ²ÙŠÙˆÙ† Ø§Ù„ Ø¬ÙŠ Ø³Ù…Ø§Ø±Øª',
            barcode: '1003000003',
            mainCategory: 'electronics',
            subCategory: 'ØªÙ„ÙØ²ÙŠÙˆÙ†Ø§Øª',
            brand: 'Ø§Ù„ Ø¬ÙŠ',
            model: 'Ø³Ù…Ø§Ø±Øª 4K',
            costPrice: 350000,
            salePrice: 400000,
            productStock: 5,
            minStock: 2,
            description: 'ØªÙ„ÙØ²ÙŠÙˆÙ† Ø°ÙƒÙŠ Ø¨Ø¯Ù‚Ø© 4K ÙˆØ­Ø¬Ù… 55 Ø¨ÙˆØµØ©',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1004,
            name: 'Ø¨Ù†Ø·Ù„ÙˆÙ† Ø¬ÙŠÙ†Ø² Ø±Ø¬Ø§Ù„ÙŠ',
            barcode: '1004000004',
            mainCategory: 'clothes',
            subCategory: 'Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠ',
            brand: 'Ù„ÙŠÙØ§ÙŠØ³',
            costPrice: 25000,
            salePrice: 35000,
            productStock: 30,
            minStock: 5,
            description: 'Ø¨Ù†Ø·Ù„ÙˆÙ† Ø¬ÙŠÙ†Ø² Ø±Ø¬Ø§Ù„ÙŠ Ø£Ø²Ø±Ù‚ Ù…Ù‚Ø§Ø³ 32',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1005,
            name: 'Ù‚Ù…ÙŠØµ Ù‚Ø·Ù† Ø±Ø¬Ø§Ù„ÙŠ',
            barcode: '1005000005',
            mainCategory: 'clothes',
            subCategory: 'Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠ',
            brand: 'Ø²Ø§Ø±Ø§',
            costPrice: 15000,
            salePrice: 25000,
            productStock: 25,
            minStock: 5,
            description: 'Ù‚Ù…ÙŠØµ Ù‚Ø·Ù† Ø±Ø¬Ø§Ù„ÙŠ Ø£Ø¨ÙŠØ¶ Ù…Ù‚Ø§Ø³ M',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1006,
            name: 'Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ Ù†Ø§ÙŠÙƒ',
            barcode: '1006000006',
            mainCategory: 'clothes',
            subCategory: 'Ø£Ø­Ø°ÙŠØ©',
            brand: 'Ù†Ø§ÙŠÙƒ',
            model: 'Ø§ÙŠØ± Ù…Ø§ÙƒØ³',
            costPrice: 40000,
            salePrice: 60000,
            productStock: 12,
            minStock: 3,
            description: 'Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ Ø£Ø³ÙˆØ¯ Ù…Ù‚Ø§Ø³ 42',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1007,
            name: 'Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ©',
            barcode: '1007000007',
            mainCategory: 'electronics',
            subCategory: 'Ø£Ø¬Ù‡Ø²Ø© ØµÙˆØª',
            brand: 'Ø¬ÙŠ Ø¨ÙŠ Ø§Ù„',
            model: 'ØªÙŠÙˆÙ† 510BT',
            costPrice: 50000,
            salePrice: 65000,
            productStock: 18,
            minStock: 5,
            description: 'Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ© Ø¨ØªÙ‚Ù†ÙŠØ© Ø¨Ù„ÙˆØªÙˆØ«',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1008,
            name: 'Ø·Ù‚Ù… Ø£ÙˆØ§Ù†ÙŠ Ù…Ø·Ø¨Ø®',
            barcode: '1008000008',
            mainCategory: 'home',
            subCategory: 'Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©',
            brand: 'ØªÙŠÙØ§Ù„',
            costPrice: 80000,
            salePrice: 100000,
            productStock: 7,
            minStock: 2,
            description: 'Ø·Ù‚Ù… Ø£ÙˆØ§Ù†ÙŠ Ù…Ø·Ø¨Ø® 7 Ù‚Ø·Ø¹ Ù…Ù† ØªÙŠÙØ§Ù„',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1009,
            name: 'Ø®Ù„Ø§Ø· ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ',
            barcode: '1009000009',
            mainCategory: 'home',
            subCategory: 'Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©',
            brand: 'ÙÙŠÙ„ÙŠØ¨Ø³',
            costPrice: 30000,
            salePrice: 45000,
            productStock: 10,
            minStock: 3,
            description: 'Ø®Ù„Ø§Ø· ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ø¨Ù‚Ø¯Ø±Ø© 500 ÙˆØ§Ø·',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        },
        {
            id: 1010,
            name: 'Ø­Ù‚ÙŠØ¨Ø© Ø¸Ù‡Ø±',
            barcode: '1010000010',
            mainCategory: 'clothes',
            subCategory: 'Ø­Ù‚Ø§Ø¦Ø¨',
            brand: 'Ù†Ø§ÙŠÙƒ',
            costPrice: 20000,
            salePrice: 30000,
            productStock: 20,
            minStock: 5,
            description: 'Ø­Ù‚ÙŠØ¨Ø© Ø¸Ù‡Ø± Ø³ÙˆØ¯Ø§Ø¡ Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ù…Ø§Ø¡',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        }
    ];
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†
    const demoCustomers = [
        {
            id: 2001,
            fullName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
            phone: '07701234567',
            email: 'ahmed@example.com',
            type: 'regular',
            address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„ÙƒØ±Ø§Ø¯Ø©',
            loyaltyPoints: 120,
            totalPurchases: 250000,
            lastVisit: new Date().toISOString(),
            createdAt: new Date().toISOString()
        },
        {
            id: 2002,
            fullName: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ',
            phone: '07709876543',
            email: 'sara@example.com',
            type: 'vip',
            address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„Ù…Ù†ØµÙˆØ±',
            loyaltyPoints: 350,
            totalPurchases: 850000,
            lastVisit: new Date().toISOString(),
            createdAt: new Date().toISOString()
        },
        {
            id: 2003,
            fullName: 'Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø³Ù…',
            phone: '07711223344',
            email: 'mohammed@example.com',
            type: 'wholesale',
            address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„ÙƒØ§Ø¸Ù…ÙŠØ©',
            loyaltyPoints: 500,
            totalPurchases: 1500000,
            lastVisit: new Date().toISOString(),
            createdAt: new Date().toISOString()
        }
    ];
    
    // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ÙŠÙ† ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†
    const demoSuppliers = [
        {
            id: 3001,
            company: 'Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',
            contact: 'Ø¹Ù„ÙŠ Ø­Ø³Ù†',
            phone: '07801234567',
            email: 'info@techcompany.com',
            address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„ÙƒØ±Ø§Ø¯Ø©',
            rating: 4,
            totalOrders: 15,
            lastOrder: new Date().toISOString(),
            createdAt: new Date().toISOString()
        },
        {
            id: 3002,
            company: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©',
            contact: 'Ù„ÙŠÙ„Ù‰ ÙƒØ±ÙŠÙ…',
            phone: '07809876543',
            email: 'info@fashioncompany.com',
            address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„Ù…Ù†ØµÙˆØ±',
            rating: 3,
            totalOrders: 8,
            lastOrder: new Date().toISOString(),
            createdAt: new Date().toISOString()
        },
        {
            id: 3003,
            company: 'Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ù†Ø²Ù„ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©',
            contact: 'Ø­Ø³Ù† Ø¹Ù„ÙŠ',
            phone: '07711122233',
            email: 'info@homeappliances.com',
            address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„ÙƒØ§Ø¸Ù…ÙŠØ©',
            rating: 5,
            totalOrders: 20,
            lastOrder: new Date().toISOString(),
            createdAt: new Date().toISOString()
        }
    ];
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¨ÙŠØ¹Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    const demoSales = [
        {
            id: 4001,
            invoiceNumber: 'INV210501-1234',
            customerId: 2001,
            customerName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
            items: [
                {
                    id: 1001,
                    name: 'Ù‡Ø§ØªÙ Ø°ÙƒÙŠ Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ Ø¬Ø§Ù„Ø§ÙƒØ³ÙŠ',
                    price: 450000,
                    quantity: 1,
                    discount: 0,
                    costPrice: 400000
                }
            ],
            subtotal: 450000,
            discount: 0,
            tax: 0,
            total: 450000,
            cost: 400000,
            profit: 50000,
            type: 'cash',
            date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // Ù‚Ø¨Ù„ Ø£Ø³Ø¨ÙˆØ¹
            cashier: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
        },
        {
            id: 4002,
            invoiceNumber: 'INV210502-5678',
            customerId: 2002,
            customerName: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ',
            items: [
                {
                    id: 1002,
                    name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Ø¯ÙŠÙ„ Ø§Ù†Ø³Ø¨Ø§ÙŠØ±ÙˆÙ†',
                    price: 800000,
                    quantity: 1,
                    discount: 5,
                    costPrice: 700000
                },
                {
                    id: 1007,
                    name: 'Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ©',
                    price: 65000,
                    quantity: 1,
                    discount: 0,
                    costPrice: 50000
                }
            ],
            subtotal: 865000,
            discount: 40000,
            tax: 0,
            total: 825000,
            cost: 750000,
            profit: 75000,
            type: 'cash',
            date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), // Ù‚Ø¨Ù„ 3 Ø£ÙŠØ§Ù…
            cashier: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
        }
    ];
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù‚Ø³Ø§Ø· ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    const today = new Date();
    const demoInstallmentSales = [
        {
            id: 5001,
            invoiceNumber: 'INV210503-9012',
            customerId: 2003,
            customerName: 'Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø³Ù…',
            customerPhone: '07711223344',
            items: [
                {
                    id: 1003,
                    name: 'ØªÙ„ÙØ²ÙŠÙˆÙ† Ø§Ù„ Ø¬ÙŠ Ø³Ù…Ø§Ø±Øª',
                    price: 400000,
                    quantity: 1,
                    discount: 0,
                    costPrice: 350000
                }
            ],
            originalAmount: 400000,
            interestRate: 5,
            totalWithInterest: 420000,
            monthlyPayment: 35000,
            installmentCount: 12,
            installments: Array.from({ length: 12 }, (_, i) => {
                const dueDate = new Date(today);
                dueDate.setMonth(today.getMonth() + i);
                return {
                    number: i + 1,
                    amount: 35000,
                    dueDate: dueDate.toISOString(),
                    paid: i < 3, // Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø¯ÙÙˆØ¹Ø©
                    paidDate: i < 3 ? new Date(dueDate.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString() : null,
                    paidAmount: i < 3 ? 35000 : 0,
                    status: i < 3 ? 'paid' : 'pending'
                };
            }),
            totalPaid: 105000, // 3 Ø£Ù‚Ø³Ø§Ø· Ã— 35000
            remainingAmount: 315000,
            cost: 350000,
            profit: 70000,
            createdDate: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString(), // Ù‚Ø¨Ù„ 3 Ø£Ø´Ù‡Ø±
            status: 'active',
            cashier: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
        }
    ];
    
    // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    const demoSettings = {
        storeName: 'Ù…ØªØ¬Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠ',
        storeAddress: 'Ø§Ù„Ø­Ù„Ø©ØŒ Ø§Ù„Ø¹Ø±Ø§Ù‚',
        storePhone: '07701234567',
        storeEmail: 'info@mystore.com',
        currency: 'IQD',
        language: 'ar',
        dateFormat: 'DD/MM/YYYY',
        defaultTaxRate: 0,
        defaultInterestRate: 5,
        defaultInstallments: 12,
        showProductImage: true,
        receiptFooter: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…. Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ÙŠÙˆÙ…Ø§Ù‹ Ø³Ø¹ÙŠØ¯Ø§Ù‹!'
    };
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    products = demoProducts;
    customers = demoCustomers;
    suppliers = demoSuppliers;
    sales = demoSales;
    installmentSales = demoInstallmentSales;
    settings = demoSettings;
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
    saveProducts();
    saveCustomers();
    saveSuppliers();
    localStorage.setItem('sales', JSON.stringify(sales));
    localStorage.setItem('installmentSales', JSON.stringify(installmentSales));
    localStorage.setItem('settings', JSON.stringify(settings));
    
    // ØªØ¹Ù„ÙŠÙ… Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§
    localStorage.setItem('demoDataLoaded', 'true');
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    loadAllData();
    applySettings();
    
    showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
function addDemoDataButton() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚Ø³Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    const dashboard = document.getElementById('dashboard');
    if (!dashboard) return;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„
    const isDemoLoaded = localStorage.getItem('demoDataLoaded');
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    const demoButton = document.createElement('div');
    demoButton.className = 'card';
    demoButton.innerHTML = `
        <div class="card-header">
            <h3 class="card-title">ğŸ’¾ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h3>
        </div>
        <div style="text-align: center;">
            <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„.</p>
            ${isDemoLoaded ? 
                '<p style="color: green;">âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„.</p>' : 
                '<button class="btn btn-primary" onclick="loadDemoData()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>'
            }
        </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    dashboard.appendChild(demoButton);
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        addDemoDataButton();
    }, 1000); // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
});

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù…Ù†Ø¹ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…
function migrateData() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: Ù†Ù‚Ù„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const updatedProducts = products.map(product => {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ movingStock (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…) ÙˆÙ„ÙƒÙ† Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡ productStock (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯)
        if (product.movingStock !== undefined && product.productStock === undefined) {
            return {
                ...product,
                productStock: product.movingStock, // Ù†Ù‚Ù„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
            };
        }
        return product;
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
    products = updatedProducts;
    saveProducts();
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    migrateData();
});oad =

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
    updateLiveTime();
    setInterval(updateLiveTime, 1000);
    
    // ØªÙ‡ÙŠØ¦Ø© ØªØ¨ÙˆÙŠØ¨ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
    initializePOS();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    loadAllData();
    loadCategories();
    applySettings();
    
    // Ø¶Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    setupTabButtons();
    
    // Ø¶Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    setupModalEvents();
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†
    setupAccordions();
    
    // ØªØ¨Ø¯Ø£ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
    showTab('pos');
});

// ØªÙ‡ÙŠØ¦Ø© ØªØ¨ÙˆÙŠØ¨ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
function initializePOS() {
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    loadProductsForPOS();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¨Ø©
    updateCartDisplay();
    
    // ØªØ¹ÙŠÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if (settings.defaultTaxRate !== undefined) {
        document.getElementById('taxRate').value = settings.defaultTaxRate;
    }
}

// Ø¶Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function setupTabButtons() {
    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.querySelectorAll('.tab-btn').forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.id.replace('btn-', '');
            showTab(tabId);
        });
    });
    
    // Ø£Ø²Ø±Ø§Ø± ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    document.querySelectorAll('#products .tab-secondary').forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            showProductTab(tabId);
        });
    });
    
    // Ø£Ø²Ø±Ø§Ø± ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    document.querySelectorAll('#customers .tab-secondary').forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            showCustomerTab(tabId);
        });
    });
    
    // Ø£Ø²Ø±Ø§Ø± ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
    document.querySelectorAll('#suppliers .tab-secondary').forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            showSupplierTab(tabId);
        });
    });
    }
    // Ø£Ø²Ø±Ø§Ø± ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    document.querySelectorAll('.tabs-secondary .tab-secondary').forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            showSettingsTab(tabId);
        });
    });
}

// Ø¶Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
function setupModalEvents() {
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    document.querySelectorAll('.close').forEach(closeButton => {
        closeButton.addEventListener('click', function() {
            const modal = this.closest('.modal');
            if (modal) {
                modal.style.display = 'none';
            }
        });
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    window.addEventListener('click', function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    });
}

// Ø¶Ø¨Ø· Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†
function setupAccordions() {
    document.querySelectorAll('.accordion-header').forEach(header => {
        header.addEventListener('click', function() {
            toggleAccordion(this);
        });
    });
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
function setupInputEvents() {
    // Ø­Ø³Ø§Ø¨ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹
    document.getElementById('costPrice')?.addEventListener('input', calculateProfitMargin);
    document.getElementById('salePrice')?.addEventListener('input', calculateProfitMargin);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.getElementById('mainCategory')?.addEventListener('change', updateSubCategories);
    
    // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®ØµÙ… Ø£Ùˆ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
    document.getElementById('totalDiscount')?.addEventListener('input', updateCartTotal);
    document.getElementById('taxRate')?.addEventListener('input', updateCartTotal);
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('productSearch')?.addEventListener('input', searchProducts);
    
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙØ¦Ø© Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    document.getElementById('categoryFilter')?.addEventListener('change', filterProducts);
    document.getElementById('priceRange')?.addEventListener('change', filterProducts);
    document.getElementById('stockFilter')?.addEventListener('change', filterProducts);
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('customerSearch')?.addEventListener('input', searchCustomers);
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('supplierSearch')?.addEventListener('input', searchSuppliers);
}

// Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', function(event) {
        // F1: ÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        if (event.key === 'F1') {
            event.preventDefault();
            showHelp();
        }
        
        // F2: Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
        if (event.key === 'F2') {
            event.preventDefault();
            showTab('pos');
        }
        
        // F3: Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
        if (event.key === 'F3') {
            event.preventDefault();
            if (document.getElementById('productSearch')) {
                document.getElementById('productSearch').focus();
            }
        }
        
        // F4: Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
        if (event.key === 'F4') {
            event.preventDefault();
            showTab('products');
            showProductTab('add-product');
        }
        
        // F5: Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        if (event.key === 'F5') {
            event.preventDefault();
            showTab('customers');
            showCustomerTab('add-customer');
        }
        
        // F8: Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        if (event.key === 'F8') {
            event.preventDefault();
            if (cart.length > 0) {
                processCashSale();
            } else {
                showNotification('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©', 'warning');
            }
        }
        
        // F9: ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„
        if (event.key === 'F9') {
            event.preventDefault();
            openCustomerModal();
        }
        
        // Esc: Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        if (event.key === 'Escape') {
            const openModals = document.querySelectorAll('.modal[style*="display: block"]');
            if (openModals.length > 0) {
                openModals.forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        }
        
        // Ctrl+S: Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)
        if (event.ctrlKey && event.key === 's') {
            event.preventDefault();
            createBackup();
        }
    });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
function showHelp() {
    const helpHTML = `
        <h3>Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­</h3>
        <table>
            <tr>
                <td><strong>F1</strong></td>
                <td>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</td>
            </tr>
            <tr>
                <td><strong>F2</strong></td>
                <td>Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</td>
            </tr>
            <tr>
                <td><strong>F3</strong></td>
                <td>Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«</td>
            </tr>
            <tr>
                <td><strong>F4</strong></td>
                <td>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</td>
            </tr>
            <tr>
                <td><strong>F5</strong></td>
                <td>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</td>
            </tr>
            <tr>
                <td><strong>F8</strong></td>
                <td>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</td>
            </tr>
            <tr>
                <td><strong>F9</strong></td>
                <td>Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„</td>
            </tr>
            <tr>
                <td><strong>Esc</strong></td>
                <td>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©</td>
            </tr>
            <tr>
                <td><strong>Ctrl+S</strong></td>
                <td>Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</td>
            </tr>
        </table>
    `;
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    const helpWindow = window.open('', '_blank', 'width=500,height=400');
    helpWindow.document.write(`
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>Ù…Ø³Ø§Ø¹Ø¯Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>
            <style>
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    padding: 20px;
                    background-color: #f5f5f5;
                }
                h2, h3 {
                    color: #667eea;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 20px 0;
                }
                th, td {
                    padding: 10px;
                    border: 1px solid #ddd;
                }
                th {
                    background-color: #667eea;
                    color: white;
                }
                tr:nth-child(even) {
                    background-color: #f2f2f2;
                }
            </style>
        </head>
        <body>
            <h2>Ù…Ø³Ø§Ø¹Ø¯Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ØªØ·ÙˆØ±</h2>
            ${helpHTML}
        </body>
        </html>
    `);
    helpWindow.document.close();
}

// ØªÙ†ÙÙŠØ° Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setupInputEvents();
    setupKeyboardShortcuts();
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    document.querySelectorAll('#settings input, #settings select, #settings textarea').forEach(element => {
        element.addEventListener('change', saveSettings);
    });
});

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
function checkForDemoData() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
    if (products.length === 0 && !localStorage.getItem('demoDataLoaded')) {
        if (confirm('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ')) {
            loadDemoData();
        }
    }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        checkForDemoData();
    }, 2000); // ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
});

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ù‚Ø³Ø§Ø· Ù…Ø³ØªØ­Ù‚Ø© ÙˆØ¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡
function checkDueInstallments() {
    if (installmentSales.length === 0) return;
    
    const today = new Date();
    const dueInstallments = [];
    
    installmentSales.forEach(sale => {
        if (sale.status !== 'active') return;
        
        sale.installments.forEach(installment => {
            if (!installment.paid) {
                const dueDate = new Date(installment.dueDate);
                const daysDifference = Math.floor((dueDate - today) / (24 * 60 * 60 * 1000));
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø³Ø· Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù… Ø£Ùˆ Ù…ØªØ£Ø®Ø±
                if (daysDifference <= 7 && daysDifference >= -30) {
                    dueInstallments.push({
                        customerName: sale.customerName,
                        amount: installment.amount,
                        dueDate: dueDate,
                        daysDifference: daysDifference,
                        installmentNumber: installment.number,
                        saleId: sale.id
                    });
                }
            }
        });
    });
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø£Ù‚Ø³Ø§Ø· Ù…Ø³ØªØ­Ù‚Ø©ØŒ Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡
    if (dueInstallments.length > 0) {
        const alertsList = document.getElementById('alertsList');
        if (alertsList) {
            // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ù„ÙƒÙ„ Ù‚Ø³Ø· Ù…Ø³ØªØ­Ù‚ (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 3 ØªÙ†Ø¨ÙŠÙ‡Ø§Øª)
            dueInstallments.slice(0, 3).forEach(installment => {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-warning';
                
                let message;
                if (installment.daysDifference < 0) {
                    message = `âš ï¸ Ø§Ù„Ù‚Ø³Ø· Ø±Ù‚Ù… ${installment.installmentNumber} Ù„Ù„Ø¹Ù…ÙŠÙ„ "${installment.customerName}" Ù…ØªØ£Ø®Ø± Ø¨Ù€ ${Math.abs(installment.daysDifference)} ÙŠÙˆÙ…`;
                } else if (installment.daysDifference === 0) {
                    message = `â„¹ï¸ Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø³Ø· Ø±Ù‚Ù… ${installment.installmentNumber} Ù„Ù„Ø¹Ù…ÙŠÙ„ "${installment.customerName}" Ø§Ù„ÙŠÙˆÙ…`;
                } else {
                    message = `â„¹ï¸ Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø³Ø· Ø±Ù‚Ù… ${installment.installmentNumber} Ù„Ù„Ø¹Ù…ÙŠÙ„ "${installment.customerName}" Ø®Ù„Ø§Ù„ ${installment.daysDifference} ÙŠÙˆÙ…`;
                }
                
                alertDiv.innerHTML = `
                    ${message}
                    <button class="btn btn-sm btn-success" onclick="addInstallmentPayment(${installment.saleId})">Ø¯ÙØ¹ Ø§Ù„Ù‚Ø³Ø·</button>
                `;
                
                alertsList.prepend(alertDiv);
            });
            
            // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£Ù‚Ø³Ø§Ø· Ù…Ø³ØªØ­Ù‚Ø©
            if (dueInstallments.length > 3) {
                const summaryAlert = document.createElement('div');
                summaryAlert.className = 'alert alert-info';
                summaryAlert.textContent = `â„¹ï¸ Ù‡Ù†Ø§Ùƒ ${dueInstallments.length} Ù‚Ø³Ø· Ù…Ø³ØªØ­Ù‚. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø³Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„.`;
                alertsList.prepend(summaryAlert);
            }
        }
    }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        checkDueInstallments();
    }, 3000); // ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
});

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡
function checkLowStockProducts() {
    if (products.length === 0) return;
    
    const lowStockProducts = products.filter(p => 
        p.productStock > 0 && p.productStock <= (p.minStock || 5)
    );
    
    const outOfStockProducts = products.filter(p => p.productStock <= 0);
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†ØŒ Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡
    if (lowStockProducts.length > 0 || outOfStockProducts.length > 0) {
        const alertsList = document.getElementById('alertsList');
        if (alertsList) {
            // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            if (lowStockProducts.length > 0) {
                // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ù„Ø£ÙˆÙ„ 3 Ù…Ù†ØªØ¬Ø§Øª
                lowStockProducts.slice(0, 3).forEach(product => {
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-warning';
                    alertDiv.textContent = `âš ï¸ Ù…Ù†ØªØ¬ "${product.name}" ÙˆØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ† (${product.productStock} ÙˆØ­Ø¯Ø©)`;
                    alertsList.prepend(alertDiv);
                });
                
                // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† 3 Ù…Ù†ØªØ¬Ø§Øª
                if (lowStockProducts.length > 3) {
                    const summaryAlert = document.createElement('div');
                    summaryAlert.className = 'alert alert-info';
                    summaryAlert.textContent = `â„¹ï¸ Ù‡Ù†Ø§Ùƒ ${lowStockProducts.length} Ù…Ù†ØªØ¬ Ø¨Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„.`;
                    alertsList.prepend(summaryAlert);
                }
            }
            
            // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙØ±Ø©
            if (outOfStockProducts.length > 0) {
                const outOfStockAlert = document.createElement('div');
                outOfStockAlert.className = 'alert alert-error';
                outOfStockAlert.textContent = `â›” Ù‡Ù†Ø§Ùƒ ${outOfStockProducts.length} Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©.`;
                alertsList.prepend(outOfStockAlert);
            }
        }
    }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        checkLowStockProducts();
    }, 3500); // ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
});



    </script>
</body>
</html>
